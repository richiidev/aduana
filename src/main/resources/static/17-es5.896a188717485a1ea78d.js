!function(){function o(o,e){if(!(o instanceof e))throw new TypeError("Cannot call a class as a function")}function e(o,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function t(o,t,r){return t&&e(o.prototype,t),r&&e(o,r),o}(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{JJEo:function(e,r,n){"use strict";n.r(r),n.d(r,"InicioPageModule",(function(){return I}));var i,a=n("ofXK"),s=n("3Pt+"),c=n("TEn/"),l=n("tyNb"),u=n("mrSG"),b=n("tk/3"),p=n("AytR"),g=n("fXoL"),m=n("lGQG"),f=((i=function(){function e(t,r,n,i){o(this,e),this.http=t,this.auth=r,this.toastCtrl=n,this.router=i}return t(e,[{key:"ngOnInit",value:function(){this.cargarForm()}},{key:"cargarForm",value:function(){this.loginForm=new s.d({rfc:new s.b(null,s.o.required),password:new s.b(null,[s.o.required,s.o.minLength(5)])})}},{key:"iniciarSesion",value:function(){var o=this,e=(new b.c).set("rfc",this.loginForm.value.rfc).set("password",this.loginForm.value.password);this.http.get(p.a.apiUrl+"/usuario/login",{params:e}).toPromise().then((function(e){if(1==e.data.length)switch(o.auth.usuario=e.data[0],localStorage.setItem("cuenta",JSON.stringify(o.auth.usuario)),o.mostrarToast("Bienvenido "+o.auth.usuario.nombre,"success"),o.auth.usuario.idrol.id){case 1:o.router.navigateByUrl("usuario",{replaceUrl:!0});break;case 2:o.router.navigateByUrl("admin",{replaceUrl:!0});break;default:o.router.navigateByUrl("agente",{replaceUrl:!0})}else o.mostrarToast("Error : datos incorrectos","danger");console.log("Resp al iniciar sesion",e)})).catch((function(e){o.mostrarToast("Error : datos incorrectos","danger"),console.log("Error al iniciar sesion",e)}))}},{key:"mostrarToast",value:function(o,e){return Object(u.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.toastCtrl.create({message:o,color:e,duration:3e3});case 2:return t.abrupt("return",t.sent.present());case 3:case"end":return t.stop()}}),t,this)})))}}]),e}()).\u0275fac=function(o){return new(o||i)(g.Hb(b.a),g.Hb(m.a),g.Hb(c.T),g.Hb(l.f))},i.\u0275cmp=g.Bb({type:i,selectors:[["app-login"]],decls:24,vars:2,consts:[[1,"ion-text-center"],[2,"padding-left","10%","padding-right","10%"],[3,"formGroup","ngSubmit"],["position","floating"],["color","danger"],["formControlName","rfc","oninput","this.value = this.value.toUpperCase()","type","text","type","text"],["formControlName","password","type","password"],["mode","ios","expand","full","color","primary","type","submit",3,"disabled"]],template:function(o,e){1&o&&(g.Kb(0,"ion-header"),g.Kb(1,"ion-toolbar",0),g.Kb(2,"ion-title"),g.gc(3,"Autententiciacion"),g.Jb(),g.Jb(),g.Jb(),g.Kb(4,"ion-content"),g.Kb(5,"ion-card",1),g.Kb(6,"ion-card-header",0),g.Kb(7,"ion-card-title"),g.gc(8,"Ingresa tus datos"),g.Jb(),g.Jb(),g.Kb(9,"form",2),g.Sb("ngSubmit",(function(){return e.iniciarSesion()})),g.Kb(10,"ion-item"),g.Kb(11,"ion-label",3),g.gc(12,"RFC "),g.Kb(13,"ion-text",4),g.gc(14,"*"),g.Jb(),g.Jb(),g.Ib(15,"ion-input",5),g.Jb(),g.Kb(16,"ion-item"),g.Kb(17,"ion-label",3),g.gc(18,"Contrasena "),g.Kb(19,"ion-text",4),g.gc(20,"*"),g.Jb(),g.Jb(),g.Ib(21,"ion-input",6),g.Jb(),g.Kb(22,"ion-button",7),g.gc(23," Iniciar sesion "),g.Jb(),g.Jb(),g.Jb(),g.Jb()),2&o&&(g.xb(9),g.Zb("formGroup",e.loginForm),g.xb(13),g.Zb("disabled",e.loginForm.invalid))},directives:[c.r,c.K,c.J,c.n,c.h,c.j,c.k,s.p,s.j,s.e,c.u,c.v,c.I,c.t,c.S,s.i,s.c,c.f],styles:[""]}),i),d=n("lJxs");function h(o,e){1&o&&(g.Kb(0,"ion-text",13),g.Kb(1,"p"),g.gc(2,"Esta disponible"),g.Jb(),g.Jb())}function v(o,e){1&o&&(g.Kb(0,"ion-text",2),g.Kb(1,"p"),g.gc(2,"NO esta disponible"),g.Jb(),g.Jb())}function J(o,e){1&o&&(g.Kb(0,"ion-text",2),g.Kb(1,"p"),g.gc(2,"Las contrase\xf1as NO son iguales"),g.Jb(),g.Jb())}var K,w,y,x,F=((K=function(){function e(t,r,n){o(this,e),this.http=t,this.toastCtrl=r,this.router=n,this.rol=1,this.existe=void 0}return t(e,[{key:"ngOnInit",value:function(){this.cargarFormulario()}},{key:"registrarce",value:function(){var o=this,e={nombre:this.registroForm.controls.nombre.value,apellidos:this.registroForm.controls.apellidos.value,correo:this.registroForm.controls.correo.value,rfc:this.registroForm.controls.rfc.value,password:this.registroForm.controls.password2.value,idrol:{id:this.rol}};console.log("El usuario seria",e),this.http.post(p.a.apiUrl+"/usuario",e).toPromise().then((function(t){if(t.success)return o.mostrarToast("Se registro correctamente","success"),o.enviarEmail({contentType:"text/plain",mailBcc:"",mailCc:"pocholowsd@gmail.com",mailContent:"Te ha registrado corractemente",mailFrom:"mx.notificationes@swissport.com",mailSubject:"Bienvenido "+e.nombre+" "+e.apellidos,mailTo:e.correo});o.mostrarToast("Algo salio mal","danger"),console.log("Resp al crear usuario",t)})).then((function(e){o.router.navigateByUrl("inicio/login"),console.log("Se envio el correo"),o.registroForm.reset({nombre:null,apellidos:null,correo:null,rfc:null,agente:null,password:null,password2:null}),o.existe=void 0})).catch((function(e){o.mostrarToast("Algo salio mal","danger"),console.log("Ocurrio un error al registrar el usuario",e)}))}},{key:"enviarEmail",value:function(o){return this.http.post(p.a.apiUrl+"/sendEmails",o).toPromise()}},{key:"mostrarToast",value:function(o,e){return Object(u.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.toastCtrl.create({message:o,color:e,duration:3e3});case 2:return t.abrupt("return",t.sent.present());case 3:case"end":return t.stop()}}),t,this)})))}},{key:"validarRfc",value:function(o){return this.http.get("".concat(p.a.apiUrl,"/usuario/rfcValidacion/?rfc=").concat(o)).pipe(Object(d.a)((function(o){return console.log("La resp",o),1==o.data.length}))).toPromise()}},{key:"validarEntrada",value:function(o){var e=this;o.length>=4&&o.length<=6?(console.log("Parece agente"),this.validarRfc(o).then((function(t){console.log("Que sale",t),t?(e.existe=!0,e.registroForm.controls.rfc.reset(null)):(e.registroForm.controls.rfc.setValue(o),e.existe=!1,e.rol=3)})).catch((function(o){console.log("Error al verificar rfc",o)}))):12!=o.length&&13!=o.length||(console.log("parece rfc"),this.validarRfc(o).then((function(t){t?(e.existe=!0,e.registroForm.controls.rfc.reset(null)):(e.registroForm.controls.rfc.setValue(o),e.existe=!1,e.rol=1)})).catch((function(o){console.log("Error al verificar rfc",o)})))}},{key:"verForm",value:function(){console.log(this.registroForm)}},{key:"cargarFormulario",value:function(){this.registroForm=new s.d({nombre:new s.b(null,[s.o.required,s.o.minLength(6)]),apellidos:new s.b(null,[s.o.required,s.o.minLength(6)]),correo:new s.b(null,[s.o.required,s.o.minLength(6)]),rfc:new s.b(null,[s.o.required,s.o.minLength(4),s.o.maxLength(13)]),password:new s.b(null,[s.o.required,s.o.minLength(5)]),password2:new s.b(null,[s.o.required,s.o.min(5)])},{validators:this.compararContras})}},{key:"compararContras",value:function(o){return o.controls.password2.value===o.controls.password.value?null:{mismatch:!0}}}]),e}()).\u0275fac=function(o){return new(o||K)(g.Hb(b.a),g.Hb(c.T),g.Hb(l.f))},K.\u0275cmp=g.Bb({type:K,selectors:[["app-signup"]],decls:48,vars:5,consts:[[1,"ion-text-center"],["position","floating"],["color","danger"],["debounce","1000","required","","oninput","this.value = this.value.toUpperCase()","type","text",3,"ionChange"],["color","success",4,"ngIf"],["color","danger",4,"ngIf"],[3,"formGroup"],["required","","formControlName","nombre","type","text"],["required","","formControlName","apellidos","type","text"],["required","","formControlName","correo","type","text"],["required","","formControlName","password","type","password"],["formControlName","password2","type","password"],["expand","full","color","primary",3,"disabled","click"],["color","success"]],template:function(o,e){1&o&&(g.Kb(0,"ion-header"),g.Kb(1,"ion-toolbar",0),g.Kb(2,"ion-title"),g.gc(3,"Registro"),g.Jb(),g.Jb(),g.Jb(),g.Kb(4,"ion-content"),g.Kb(5,"ion-card"),g.Kb(6,"ion-item"),g.Kb(7,"ion-label",1),g.gc(8,"RFC o numero de agente"),g.Kb(9,"ion-text",2),g.gc(10,"*"),g.Jb(),g.Jb(),g.Kb(11,"ion-input",3),g.Sb("ionChange",(function(o){return e.validarEntrada(o.target.value)})),g.Jb(),g.fc(12,h,3,0,"ion-text",4),g.fc(13,v,3,0,"ion-text",5),g.Jb(),g.Kb(14,"form",6),g.Kb(15,"ion-item"),g.Kb(16,"ion-label",1),g.gc(17,"Nombres "),g.Kb(18,"ion-text",2),g.gc(19,"*"),g.Jb(),g.Jb(),g.Ib(20,"ion-input",7),g.Jb(),g.Kb(21,"ion-item"),g.Kb(22,"ion-label",1),g.gc(23,"Apellidos "),g.Kb(24,"ion-text",2),g.gc(25,"*"),g.Jb(),g.Jb(),g.Ib(26,"ion-input",8),g.Jb(),g.Kb(27,"ion-item"),g.Kb(28,"ion-label",1),g.gc(29,"Correo electronico "),g.Kb(30,"ion-text",2),g.gc(31,"*"),g.Jb(),g.Jb(),g.Ib(32,"ion-input",9),g.Jb(),g.Kb(33,"ion-item"),g.Kb(34,"ion-label",1),g.gc(35,"Contrasena "),g.Kb(36,"ion-text",2),g.gc(37,"*"),g.Jb(),g.Jb(),g.Ib(38,"ion-input",10),g.Jb(),g.Kb(39,"ion-item"),g.Kb(40,"ion-label",1),g.gc(41,"Repite tu contrasena "),g.Kb(42,"ion-text",2),g.gc(43,"*"),g.Jb(),g.Jb(),g.Ib(44,"ion-input",11),g.fc(45,J,3,0,"ion-text",5),g.Jb(),g.Jb(),g.Kb(46,"ion-button",12),g.Sb("click",(function(){return e.registrarce()})),g.gc(47," Registrate\n"),g.Jb(),g.Jb(),g.Jb()),2&o&&(g.xb(12),g.Zb("ngIf",null!=e.existe&&!e.existe),g.xb(1),g.Zb("ngIf",e.existe),g.xb(1),g.Zb("formGroup",e.registroForm),g.xb(31),g.Zb("ngIf",(null==e.registroForm.errors?null:e.registroForm.errors.mismatch)&&(e.registroForm.controls.password2.dirty||e.registroForm.controls.password2.touched)),g.xb(1),g.Zb("disabled",e.registroForm.invalid))},directives:[c.r,c.K,c.J,c.n,c.h,c.u,c.v,c.I,c.t,c.S,a.j,s.p,s.j,s.e,s.n,s.i,s.c,c.f],styles:[""]}),K),C=[{path:"",component:(w=function(){function e(){o(this,e)}return t(e,[{key:"ngOnInit",value:function(){}}]),e}(),w.\u0275fac=function(o){return new(o||w)},w.\u0275cmp=g.Bb({type:w,selectors:[["app-inicio"]],decls:10,vars:0,consts:[["slot","bottom,top"],["tab","login"],["name","person-circle"],["tab","signup"],["name","create"]],template:function(o,e){1&o&&(g.Kb(0,"ion-tabs"),g.Kb(1,"ion-tab-bar",0),g.Kb(2,"ion-tab-button",1),g.Ib(3,"ion-icon",2),g.Kb(4,"ion-label"),g.gc(5,"Iniciar sesion"),g.Jb(),g.Jb(),g.Kb(6,"ion-tab-button",3),g.Ib(7,"ion-icon",4),g.Kb(8,"ion-label"),g.gc(9,"Registrate"),g.Jb(),g.Jb(),g.Jb(),g.Jb())},directives:[c.H,c.F,c.G,c.s,c.v],styles:[""]}),w),children:[{path:"",redirectTo:"login",pathMatch:"full"},{path:"login",component:f},{path:"signup",component:F}]}],k=((x=function e(){o(this,e)}).\u0275mod=g.Fb({type:x}),x.\u0275inj=g.Eb({factory:function(o){return new(o||x)},imports:[[l.h.forChild(C)],l.h]}),x),I=((y=function e(){o(this,e)}).\u0275mod=g.Fb({type:y}),y.\u0275inj=g.Eb({factory:function(o){return new(o||y)},imports:[[a.b,s.f,c.M,s.m,b.b,k]]}),y)}}])}();