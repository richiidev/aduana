(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{JJEo:function(o,t,r){"use strict";r.r(t),r.d(t,"InicioPageModule",(function(){return v}));var e=r("ofXK"),i=r("3Pt+"),n=r("TEn/"),s=r("tyNb"),a=r("mrSG"),l=r("tk/3"),c=r("AytR"),b=r("fXoL"),u=r("lGQG");let m=(()=>{class o{constructor(o,t,r,e){this.http=o,this.auth=t,this.toastCtrl=r,this.router=e}ngOnInit(){this.cargarForm()}cargarForm(){this.loginForm=new i.c({rfc:new i.a(null,i.m.required),password:new i.a(null,[i.m.required,i.m.minLength(5)])})}iniciarSesion(){const o=(new l.c).set("rfc",this.loginForm.value.rfc).set("password",this.loginForm.value.password);this.http.get(c.a.apiUrl+"/usuario/login",{params:o}).toPromise().then(o=>{if(1==o.data.length)switch(this.auth.usuario=o.data[0],localStorage.setItem("cuenta",JSON.stringify(this.auth.usuario)),this.mostrarToast("Bienvenido "+this.auth.usuario.nombre,"success"),this.auth.usuario.idrol.id){case 1:this.router.navigateByUrl("usuario",{replaceUrl:!0});break;case 2:this.router.navigateByUrl("admin",{replaceUrl:!0});break;default:this.router.navigateByUrl("agente",{replaceUrl:!0})}else this.mostrarToast("Error : datos incorrectos","danger");console.log("Resp al iniciar sesion",o)}).catch(o=>{this.mostrarToast("Error : datos incorrectos","danger"),console.log("Error al iniciar sesion",o)})}mostrarToast(o,t){return Object(a.b)(this,void 0,void 0,(function*(){return(yield this.toastCtrl.create({message:o,color:t,duration:3e3})).present()}))}}return o.\u0275fac=function(t){return new(t||o)(b.Hb(l.a),b.Hb(u.a),b.Hb(n.S),b.Hb(s.f))},o.\u0275cmp=b.Bb({type:o,selectors:[["app-login"]],decls:24,vars:2,consts:[[1,"ion-text-center"],[2,"padding-left","10%","padding-right","10%"],[3,"formGroup","ngSubmit"],["position","floating"],["color","danger"],["formControlName","rfc","oninput","this.value = this.value.toUpperCase()","type","text","type","text"],["formControlName","password","type","password"],["mode","ios","expand","full","color","primary","type","submit",3,"disabled"]],template:function(o,t){1&o&&(b.Kb(0,"ion-header"),b.Kb(1,"ion-toolbar",0),b.Kb(2,"ion-title"),b.gc(3,"Autententiciacion"),b.Jb(),b.Jb(),b.Jb(),b.Kb(4,"ion-content"),b.Kb(5,"ion-card",1),b.Kb(6,"ion-card-header",0),b.Kb(7,"ion-card-title"),b.gc(8,"Ingresa tus datos"),b.Jb(),b.Jb(),b.Kb(9,"form",2),b.Sb("ngSubmit",(function(){return t.iniciarSesion()})),b.Kb(10,"ion-item"),b.Kb(11,"ion-label",3),b.gc(12,"RFC "),b.Kb(13,"ion-text",4),b.gc(14,"*"),b.Jb(),b.Jb(),b.Ib(15,"ion-input",5),b.Jb(),b.Kb(16,"ion-item"),b.Kb(17,"ion-label",3),b.gc(18,"Contrasena "),b.Kb(19,"ion-text",4),b.gc(20,"*"),b.Jb(),b.Jb(),b.Ib(21,"ion-input",6),b.Jb(),b.Kb(22,"ion-button",7),b.gc(23," Iniciar sesion "),b.Jb(),b.Jb(),b.Jb(),b.Jb()),2&o&&(b.xb(9),b.Zb("formGroup",t.loginForm),b.xb(13),b.Zb("disabled",t.loginForm.invalid))},directives:[n.q,n.J,n.I,n.n,n.h,n.j,n.k,i.n,i.i,i.d,n.t,n.u,n.H,n.s,n.R,i.h,i.b,n.f],styles:[""]}),o})();var g=r("lJxs");function p(o,t){1&o&&(b.Kb(0,"ion-text",13),b.Kb(1,"p"),b.gc(2,"Esta disponible"),b.Jb(),b.Jb())}function d(o,t){1&o&&(b.Kb(0,"ion-text",2),b.Kb(1,"p"),b.gc(2,"NO esta disponible"),b.Jb(),b.Jb())}function h(o,t){1&o&&(b.Kb(0,"ion-text",2),b.Kb(1,"p"),b.gc(2,"Las contrase\xf1as NO son iguales"),b.Jb(),b.Jb())}let f=(()=>{class o{constructor(o,t,r){this.http=o,this.toastCtrl=t,this.router=r,this.rol=1,this.existe=void 0}ngOnInit(){this.cargarFormulario()}registrarce(){const o={nombre:this.registroForm.controls.nombre.value,apellidos:this.registroForm.controls.apellidos.value,correo:this.registroForm.controls.correo.value,rfc:this.registroForm.controls.rfc.value,password:this.registroForm.controls.password2.value,idrol:{id:this.rol}};console.log("El usuario seria",o),this.http.post(c.a.apiUrl+"/usuario",o).toPromise().then(t=>{if(t.success)return this.mostrarToast("Se registro correctamente","success"),this.enviarEmail({contentType:"text/plain",mailBcc:"",mailCc:"pocholowsd@gmail.com",mailContent:"Te ha registrado corractemente",mailFrom:"mx.notificationes@swissport.com",mailSubject:"Bienvenido "+o.nombre+" "+o.apellidos,mailTo:o.correo});this.mostrarToast("Algo salio mal","danger"),console.log("Resp al crear usuario",t)}).then(o=>{this.router.navigateByUrl("inicio/login"),console.log("Se envio el correo"),this.registroForm.reset({nombre:null,apellidos:null,correo:null,rfc:null,agente:null,password:null,password2:null}),this.existe=void 0}).catch(o=>{this.mostrarToast("Algo salio mal","danger"),console.log("Ocurrio un error al registrar el usuario",o)})}enviarEmail(o){return this.http.post(c.a.apiUrl+"/sendEmails",o).toPromise()}mostrarToast(o,t){return Object(a.b)(this,void 0,void 0,(function*(){return(yield this.toastCtrl.create({message:o,color:t,duration:3e3})).present()}))}validarRfc(o){return this.http.get(`${c.a.apiUrl}/usuario/rfcValidacion/?rfc=${o}`).pipe(Object(g.a)(o=>(console.log("La resp",o),1==o.data.length))).toPromise()}validarEntrada(o){o.length>=4&&o.length<=6?(console.log("Parece agente"),this.validarRfc(o).then(t=>{console.log("Que sale",t),t?(this.existe=!0,this.registroForm.controls.rfc.reset(null)):(this.registroForm.controls.rfc.setValue(o),this.existe=!1,this.rol=3)}).catch(o=>{console.log("Error al verificar rfc",o)})):12!=o.length&&13!=o.length||(console.log("parece rfc"),this.validarRfc(o).then(t=>{t?(this.existe=!0,this.registroForm.controls.rfc.reset(null)):(this.registroForm.controls.rfc.setValue(o),this.existe=!1,this.rol=1)}).catch(o=>{console.log("Error al verificar rfc",o)}))}verForm(){console.log(this.registroForm)}cargarFormulario(){this.registroForm=new i.c({nombre:new i.a(null,[i.m.required,i.m.minLength(6)]),apellidos:new i.a(null,[i.m.required,i.m.minLength(6)]),correo:new i.a(null,[i.m.required,i.m.minLength(6)]),rfc:new i.a(null,[i.m.required,i.m.minLength(4),i.m.maxLength(13)]),password:new i.a(null,[i.m.required,i.m.minLength(5)]),password2:new i.a(null,[i.m.required,i.m.min(5)])},{validators:this.compararContras})}compararContras(o){return o.controls.password2.value===o.controls.password.value?null:{mismatch:!0}}}return o.\u0275fac=function(t){return new(t||o)(b.Hb(l.a),b.Hb(n.S),b.Hb(s.f))},o.\u0275cmp=b.Bb({type:o,selectors:[["app-signup"]],decls:48,vars:5,consts:[[1,"ion-text-center"],["position","floating"],["color","danger"],["debounce","1000","required","","oninput","this.value = this.value.toUpperCase()","type","text",3,"ionChange"],["color","success",4,"ngIf"],["color","danger",4,"ngIf"],[3,"formGroup"],["required","","formControlName","nombre","type","text"],["required","","formControlName","apellidos","type","text"],["required","","formControlName","correo","type","text"],["required","","formControlName","password","type","password"],["formControlName","password2","type","password"],["expand","full","color","primary",3,"disabled","click"],["color","success"]],template:function(o,t){1&o&&(b.Kb(0,"ion-header"),b.Kb(1,"ion-toolbar",0),b.Kb(2,"ion-title"),b.gc(3,"Registro"),b.Jb(),b.Jb(),b.Jb(),b.Kb(4,"ion-content"),b.Kb(5,"ion-card"),b.Kb(6,"ion-item"),b.Kb(7,"ion-label",1),b.gc(8,"RFC o numero de agente"),b.Kb(9,"ion-text",2),b.gc(10,"*"),b.Jb(),b.Jb(),b.Kb(11,"ion-input",3),b.Sb("ionChange",(function(o){return t.validarEntrada(o.target.value)})),b.Jb(),b.fc(12,p,3,0,"ion-text",4),b.fc(13,d,3,0,"ion-text",5),b.Jb(),b.Kb(14,"form",6),b.Kb(15,"ion-item"),b.Kb(16,"ion-label",1),b.gc(17,"Nombres "),b.Kb(18,"ion-text",2),b.gc(19,"*"),b.Jb(),b.Jb(),b.Ib(20,"ion-input",7),b.Jb(),b.Kb(21,"ion-item"),b.Kb(22,"ion-label",1),b.gc(23,"Apellidos "),b.Kb(24,"ion-text",2),b.gc(25,"*"),b.Jb(),b.Jb(),b.Ib(26,"ion-input",8),b.Jb(),b.Kb(27,"ion-item"),b.Kb(28,"ion-label",1),b.gc(29,"Correo electronico "),b.Kb(30,"ion-text",2),b.gc(31,"*"),b.Jb(),b.Jb(),b.Ib(32,"ion-input",9),b.Jb(),b.Kb(33,"ion-item"),b.Kb(34,"ion-label",1),b.gc(35,"Contrasena "),b.Kb(36,"ion-text",2),b.gc(37,"*"),b.Jb(),b.Jb(),b.Ib(38,"ion-input",10),b.Jb(),b.Kb(39,"ion-item"),b.Kb(40,"ion-label",1),b.gc(41,"Repite tu contrasena "),b.Kb(42,"ion-text",2),b.gc(43,"*"),b.Jb(),b.Jb(),b.Ib(44,"ion-input",11),b.fc(45,h,3,0,"ion-text",5),b.Jb(),b.Jb(),b.Kb(46,"ion-button",12),b.Sb("click",(function(){return t.registrarce()})),b.gc(47," Registrate\n"),b.Jb(),b.Jb(),b.Jb()),2&o&&(b.xb(12),b.Zb("ngIf",null!=t.existe&&!t.existe),b.xb(1),b.Zb("ngIf",t.existe),b.xb(1),b.Zb("formGroup",t.registroForm),b.xb(31),b.Zb("ngIf",(null==t.registroForm.errors?null:t.registroForm.errors.mismatch)&&(t.registroForm.controls.password2.dirty||t.registroForm.controls.password2.touched)),b.xb(1),b.Zb("disabled",t.registroForm.invalid))},directives:[n.q,n.J,n.I,n.n,n.h,n.t,n.u,n.H,n.s,n.R,e.j,i.n,i.i,i.d,i.l,i.h,i.b,n.f],styles:[""]}),o})();const J=[{path:"",component:(()=>{class o{constructor(){}ngOnInit(){}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=b.Bb({type:o,selectors:[["app-inicio"]],decls:10,vars:0,consts:[["slot","bottom,top"],["tab","login"],["name","person-circle"],["tab","signup"],["name","create"]],template:function(o,t){1&o&&(b.Kb(0,"ion-tabs"),b.Kb(1,"ion-tab-bar",0),b.Kb(2,"ion-tab-button",1),b.Ib(3,"ion-icon",2),b.Kb(4,"ion-label"),b.gc(5,"Iniciar sesion"),b.Jb(),b.Jb(),b.Kb(6,"ion-tab-button",3),b.Ib(7,"ion-icon",4),b.Kb(8,"ion-label"),b.gc(9,"Registrate"),b.Jb(),b.Jb(),b.Jb(),b.Jb())},directives:[n.G,n.E,n.F,n.r,n.u],styles:[""]}),o})(),children:[{path:"",redirectTo:"login",pathMatch:"full"},{path:"login",component:m},{path:"signup",component:f}]}];let K=(()=>{class o{}return o.\u0275mod=b.Fb({type:o}),o.\u0275inj=b.Eb({factory:function(t){return new(t||o)},imports:[[s.h.forChild(J)],s.h]}),o})(),v=(()=>{class o{}return o.\u0275mod=b.Fb({type:o}),o.\u0275inj=b.Eb({factory:function(t){return new(t||o)},imports:[[e.b,i.e,n.L,i.k,l.b,K]]}),o})()}}]);