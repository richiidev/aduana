!function(){function e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function n(e,n){for(var t=0;t<n.length;t++){var c=n[t];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(e,c.key,c)}}(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{xnqB:function(t,c,a){"use strict";a.r(c),a.d(c,"FacturasPageModule",(function(){return J}));var o=a("ofXK"),i=a("3Pt+"),r=a("TEn/"),s=a("tyNb"),l=a("mrSG"),u=a("AytR"),b=a("fXoL"),f=a("tk/3"),h=a("lGQG");function p(e,n){if(1&e&&(b.Kb(0,"p"),b.gc(1),b.Vb(2,"date"),b.Jb()),2&e){var t=b.Ub();b.xb(1),b.hc(b.Wb(2,1,t.fechaInicio))}}function d(e,n){if(1&e&&(b.Kb(0,"p"),b.gc(1),b.Vb(2,"date"),b.Jb()),2&e){var t=b.Ub();b.xb(1),b.hc(b.Wb(2,1,t.fechaFinal))}}function g(e,n){if(1&e){var t=b.Lb();b.Kb(0,"ion-item"),b.Kb(1,"ion-checkbox",11),b.Sb("ngModelChange",(function(e){return b.cc(t),n.$implicit.check=e})),b.Jb(),b.Kb(2,"ion-label"),b.gc(3," RFC "),b.Kb(4,"p"),b.gc(5),b.Jb(),b.Jb(),b.Kb(6,"ion-label"),b.gc(7," Agente "),b.Kb(8,"p"),b.gc(9),b.Jb(),b.Jb(),b.Kb(10,"ion-label"),b.gc(11," Factura "),b.Kb(12,"p"),b.gc(13),b.Jb(),b.Jb(),b.Kb(14,"ion-label"),b.gc(15," pedimento "),b.Kb(16,"p"),b.gc(17),b.Jb(),b.Jb(),b.Kb(18,"ion-label"),b.gc(19," Fecha "),b.Kb(20,"p"),b.gc(21),b.Jb(),b.Jb(),b.Jb()}if(2&e){var c=n.$implicit;b.xb(1),b.Zb("ngModel",c.check),b.xb(4),b.ic(" ",c.rfc," "),b.xb(4),b.ic(" ",c.agente," "),b.xb(4),b.ic(" ",c.factura," "),b.xb(4),b.ic(" ",c.pedimento," "),b.xb(4),b.ic(" ",c.fecha," ")}}var m,v,k,x=[{path:"",component:(m=function(){function t(n,c,a,o){e(this,t),this.http=n,this.toastCtrl=c,this.auth=a,this.actionSheetController=o,this.facturas=void 0,this.seleccionados=[],this.fechaInicio="",this.fechaFinal=""}var c,a,o;return c=t,(a=[{key:"ngOnInit",value:function(){this.peticionFactura("facturas/agente?agente="+this.auth.usuario.rfc)}},{key:"setFechaInicio",value:function(e){console.log("la fecha inicio es",e),this.fechaInicio=e}},{key:"setFechaFinal",value:function(e){console.log("la fecha final es",e),this.fechaFinal=e}},{key:"seleccionar",value:function(){var e=this;this.facturas.forEach((function(n,t){n.check&&e.seleccionados.push({index:t,factura:n.factura})})),1==this.seleccionados.length?this.mostrarOpcionesIndividual(this.seleccionados[0].index):this.mostrarOpcionesMultiple(),console.log("Seleccionados",this.seleccionados)}},{key:"mostrarOpcionesMultiple",value:function(){return Object(l.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.actionSheetController.create({header:"Que deseas hacer con las facturas seleccionadas : ",cssClass:"my-custom-class",buttons:[{text:"Descargar xml y pdf seleccionados",icon:"cloud-download",handler:function(){t.descargarZip()}},{text:"Canelar",icon:"close",role:"cancel",handler:function(){console.log("Cancel clicked")}}]});case 2:return n=e.sent,e.next=5,n.present();case 5:case"end":return e.stop()}}),e,this)})))}},{key:"descargarZip",value:function(){var e=this,n=[];this.seleccionados.forEach((function(e){n.push("C:\\Program Files\\Apache Software Foundation\\Tomcat 8.5\\webapps\\file\\"+e.factura+".xml"),n.push("C:\\Program Files\\Apache Software Foundation\\Tomcat 8.5\\webapps\\file\\"+e.factura+".pdf")}));var t=(new Date).toISOString();this.http.post("".concat(u.a.apiUrl,"/zip?zipFile=C:\\Program Files\\Apache Software Foundation\\Tomcat 8.5\\webapps\\file\\").concat(t),n).toPromise().then((function(n){console.log("Resp de hacer zip archivos",n),n.success&&e.descargar(t)})).catch((function(n){console.log("Error al comprimir archios",n),e.mostrarToast("Error al descargar el zip","danger")}))}},{key:"descargar",value:function(e){var n=document.createElement("a");n.href="".concat(u.a.apiFile,"/file/").concat(e),n.setAttribute("target","download"),n.click(),n.remove()}},{key:"mostrarOpcionesIndividual",value:function(e){return Object(l.b)(this,void 0,void 0,regeneratorRuntime.mark((function n(){var t,c=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.actionSheetController.create({header:"Que deseas hacer con el pago con RFC : "+this.facturas[e].rfc+", Agente: "+this.facturas[e].agente,cssClass:"my-custom-class",buttons:[{text:"Abrir archivo XML",icon:"code-working",handler:function(){c.abrirArchivo(e,"xml")}},{text:"Abrir archivo PDF",icon:"document",handler:function(){c.abrirArchivo(e,"pdf")}},{text:"Canelar",icon:"close",role:"cancel",handler:function(){console.log("Cancel clicked")}}]});case 2:return t=n.sent,n.next=5,t.present();case 5:case"end":return n.stop()}}),n,this)})))}},{key:"abrirArchivo",value:function(e,n){var t=document.createElement("a");t.href="".concat(u.a.apiFile,"/file/").concat(this.facturas[e].factura,".").concat(n),t.setAttribute("target","_blank"),t.click(),t.remove()}},{key:"peticionFactura",value:function(e){var n=this;this.http.get("".concat(u.a.apiUrl,"/").concat(e)).subscribe((function(e){console.log("Resp de buscar factura",e),e.data.length>0?(n.facturas=e.data,n.mostrarToast("Se encontraron","success")):n.mostrarToast("No se encotraron","danger")}),(function(e){console.log("Error al buscar la factura",e)}))}},{key:"mostrarToast",value:function(e,n){return Object(l.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.toastCtrl.create({message:e,color:n,duration:3e3});case 2:return c=t.sent,t.next=5,c.present();case 5:case"end":return t.stop()}}),t,this)})))}}])&&n(c.prototype,a),o&&n(c,o),t}(),m.\u0275fac=function(e){return new(e||m)(b.Hb(f.a),b.Hb(r.T),b.Hb(h.a),b.Hb(r.a))},m.\u0275cmp=b.Bb({type:m,selectors:[["app-facturas"]],decls:26,vars:3,consts:[["color","primary",1,"ion-text-center"],["display-format","YYYY-MM-DD",2,"display","none",3,"ionChange"],["fechasInicio",""],["fechasFinal",""],["size","6"],["expand","block","color","dark",3,"click"],["name","checkbox-outline"],["color","danger","expand","block",3,"click"],[4,"ngIf"],[3,"items"],[4,"virtualItem"],[3,"ngModel","ngModelChange"]],template:function(e,n){if(1&e){var t=b.Lb();b.Kb(0,"ion-header"),b.Kb(1,"ion-toolbar",0),b.Kb(2,"ion-title"),b.gc(3,"Mis facturas"),b.Jb(),b.Kb(4,"ion-datetime",1,2),b.Sb("ionChange",(function(e){return n.setFechaInicio(e.target.value)})),b.Jb(),b.Kb(6,"ion-datetime",1,3),b.Sb("ionChange",(function(e){return n.setFechaFinal(e.target.value)})),b.Jb(),b.Kb(8,"ion-row"),b.Kb(9,"ion-col",4),b.Kb(10,"ion-button",5),b.Sb("click",(function(){return n.seleccionar()})),b.Ib(11,"ion-icon",6),b.gc(12," Opciones Factura 's' seleccionada 's' "),b.Jb(),b.Jb(),b.Kb(13,"ion-col",4),b.Kb(14,"ion-row"),b.Kb(15,"ion-col",4),b.Kb(16,"ion-button",7),b.Sb("click",(function(){return b.cc(t),b.bc(5).open()})),b.gc(17," Fecha de inicio "),b.Jb(),b.fc(18,p,3,3,"p",8),b.Jb(),b.Kb(19,"ion-col",4),b.Kb(20,"ion-button",7),b.Sb("click",(function(){return b.cc(t),b.bc(7).open()})),b.gc(21," Fecha final "),b.Jb(),b.fc(22,d,3,3,"p",8),b.Jb(),b.Jb(),b.Jb(),b.Jb(),b.Jb(),b.Jb(),b.Kb(23,"ion-content"),b.Kb(24,"ion-virtual-scroll",9),b.fc(25,g,22,6,"ion-item",10),b.Jb(),b.Jb()}2&e&&(b.xb(18),b.Zb("ngIf",""!=n.fechaInicio),b.xb(4),b.Zb("ngIf",""!=n.fechaFinal),b.xb(2),b.Zb("items",n.facturas))},directives:[r.r,r.K,r.J,r.o,r.R,r.A,r.m,r.f,r.s,o.j,r.n,r.L,r.U,r.u,r.l,r.c,i.i,i.k,r.v],pipes:[o.d],styles:[""]}),m)}],F=((k=function n(){e(this,n)}).\u0275mod=b.Fb({type:k}),k.\u0275inj=b.Eb({factory:function(e){return new(e||k)},imports:[[s.h.forChild(x)],s.h]}),k),J=((v=function n(){e(this,n)}).\u0275mod=b.Fb({type:v}),v.\u0275inj=b.Eb({factory:function(e){return new(e||v)},imports:[[o.b,i.f,r.M,F]]}),v)}}])}();