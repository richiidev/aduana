!function(){function o(o,r){if(!(o instanceof r))throw new TypeError("Cannot call a class as a function")}function r(o,r){for(var e=0;e<r.length;e++){var t=r[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(o,t.key,t)}}function e(o,e,t){return e&&r(o.prototype,e),t&&r(o,t),o}(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{JJEo:function(r,t,n){"use strict";n.r(t),n.d(t,"InicioPageModule",(function(){return U}));var i,a=n("ofXK"),s=n("3Pt+"),c=n("TEn/"),l=n("tyNb"),u=n("mrSG"),b=n("tk/3"),m=n("AytR"),g=n("fXoL"),p=n("lGQG"),d=((i=function(){function r(e,t,n,i){o(this,r),this.http=e,this.auth=t,this.toastCtrl=n,this.router=i}return e(r,[{key:"ngOnInit",value:function(){this.cargarForm()}},{key:"cargarForm",value:function(){this.loginForm=new s.c({rfc:new s.a(null,s.m.required),password:new s.a(null,[s.m.required,s.m.minLength(5)])})}},{key:"iniciarSesion",value:function(){var o=this,r=(new b.c).set("rfc",this.loginForm.value.rfc).set("password",this.loginForm.value.password);this.http.get(m.a.apiUrl+"/usuario/login",{params:r}).toPromise().then((function(r){if(1==r.data.length)switch(o.auth.usuario=r.data[0],localStorage.setItem("cuenta",JSON.stringify(o.auth.usuario)),o.mostrarToast("Bienvenido "+o.auth.usuario.nombre,"success"),o.auth.usuario.idrol.id){case 1:o.router.navigateByUrl("usuario",{replaceUrl:!0});break;case 2:o.router.navigateByUrl("admin",{replaceUrl:!0});break;default:o.router.navigateByUrl("agente",{replaceUrl:!0})}else o.mostrarToast("Error : datos incorrectos","danger");console.log("Resp al iniciar sesion",r)})).catch((function(r){o.mostrarToast("Error : datos incorrectos","danger"),console.log("Error al iniciar sesion",r)}))}},{key:"mostrarToast",value:function(o,r){return Object(u.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.toastCtrl.create({message:o,color:r,duration:3e3});case 2:return e.abrupt("return",e.sent.present());case 3:case"end":return e.stop()}}),e,this)})))}}]),r}()).\u0275fac=function(o){return new(o||i)(g.Hb(b.a),g.Hb(p.a),g.Hb(c.U),g.Hb(l.f))},i.\u0275cmp=g.Bb({type:i,selectors:[["app-login"]],decls:24,vars:2,consts:[[1,"ion-text-center"],[2,"padding-left","10%","padding-right","10%"],[3,"formGroup","ngSubmit"],["position","floating"],["color","danger"],["formControlName","rfc","oninput","this.value = this.value.toUpperCase()","type","text","type","text"],["formControlName","password","type","password"],["mode","ios","expand","full","color","primary","type","submit",3,"disabled"]],template:function(o,r){1&o&&(g.Kb(0,"ion-header"),g.Kb(1,"ion-toolbar",0),g.Kb(2,"ion-title"),g.gc(3,"Autententiciacion"),g.Jb(),g.Jb(),g.Jb(),g.Kb(4,"ion-content"),g.Kb(5,"ion-card",1),g.Kb(6,"ion-card-header",0),g.Kb(7,"ion-card-title"),g.gc(8,"Ingresa tus datos"),g.Jb(),g.Jb(),g.Kb(9,"form",2),g.Sb("ngSubmit",(function(){return r.iniciarSesion()})),g.Kb(10,"ion-item"),g.Kb(11,"ion-label",3),g.gc(12,"RFC "),g.Kb(13,"ion-text",4),g.gc(14,"*"),g.Jb(),g.Jb(),g.Ib(15,"ion-input",5),g.Jb(),g.Kb(16,"ion-item"),g.Kb(17,"ion-label",3),g.gc(18,"Contrasena "),g.Kb(19,"ion-text",4),g.gc(20,"*"),g.Jb(),g.Jb(),g.Ib(21,"ion-input",6),g.Jb(),g.Kb(22,"ion-button",7),g.gc(23," Iniciar sesion "),g.Jb(),g.Jb(),g.Jb(),g.Jb()),2&o&&(g.xb(9),g.Zb("formGroup",r.loginForm),g.xb(13),g.Zb("disabled",r.loginForm.invalid))},directives:[c.s,c.L,c.K,c.n,c.h,c.j,c.k,s.n,s.i,s.d,c.v,c.w,c.J,c.u,c.T,s.h,s.b,c.f],styles:[""]}),i);function f(o,r){1&o&&(g.Kb(0,"p"),g.gc(1,"El RFC es necesario"),g.Jb())}function h(o,r){if(1&o&&(g.Kb(0,"ion-text",3),g.fc(1,f,2,0,"p",15),g.Kb(2,"p"),g.gc(3," El RFC "),g.Kb(4,"ion-badge",16),g.gc(5,"NO ESTA disponible"),g.Jb(),g.Jb(),g.Jb()),2&o){var e=g.Ub();g.xb(1),g.Zb("ngIf",(null==e.registroForm.controls.rfc.errors?null:e.registroForm.controls.rfc.errors.required)&&e.registroForm.controls.rfc.dirty)}}function J(o,r){1&o&&(g.Kb(0,"ion-text",17),g.Kb(1,"p"),g.gc(2," El RFC esta "),g.Kb(3,"ion-badge",18),g.gc(4,"DISPONIBLE"),g.Jb(),g.Jb(),g.Jb())}function v(o,r){if(1&o&&(g.Kb(0,"ion-select-option",19),g.gc(1),g.Jb()),2&o){var e=r.$implicit;g.Zb("value",e.id),g.xb(1),g.hc(e.rol)}}function K(o,r){1&o&&(g.Kb(0,"ion-text",3),g.Kb(1,"p"),g.gc(2,"Las contrase\xf1as NO son iguales"),g.Jb(),g.Jb())}var w,y,x,F,I=((w=function(){function r(e,t,n){o(this,r),this.http=e,this.toastCtrl=t,this.router=n,this.roles=[{id:1,rol:"Usuario"},{id:3,rol:"Agente"}]}return e(r,[{key:"ngOnInit",value:function(){this.cargarFormulario()}},{key:"registrarce",value:function(){var o=this,r={nombre:this.registroForm.controls.nombre.value,apellidos:this.registroForm.controls.apellidos.value,correo:this.registroForm.controls.correo.value,rfc:this.registroForm.controls.rfc.value,password:this.registroForm.controls.password2.value,idrol:{id:this.registroForm.controls.idrol.value}};console.log("El usuario seria",r),this.http.post(m.a.apiUrl+"/usuario",r).subscribe((function(r){r.success?(o.mostrarToast("Se registro correctamente","success"),o.registroForm.reset({nombre:null,apellidos:null,correo:null,rfc:null,idrol:1,password:null,password2:null}),o.router.navigateByUrl("inicio/login")):o.mostrarToast("Algo salio mal","danger"),console.log("Resp al crear usuario",r)}),(function(o){return console.log("Ocurrio un error al crear el usuario",o)}))}},{key:"mostrarToast",value:function(o,r){return Object(u.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.toastCtrl.create({message:o,color:r,duration:3e3});case 2:return e.abrupt("return",e.sent.present());case 3:case"end":return e.stop()}}),e,this)})))}},{key:"rfcUnico",value:function(o){var r=this;return new Promise((function(o,e){r.http.get("".concat(m.a.apiUrl,"/usuario/rfcValidacion/?rfc=").concat(r.registroForm.controls.rfc.value)).subscribe((function(r){console.log("Se hizo bien",r),o(1==r.data.length?{existe:!0}:null)}),(function(r){console.log("Se hizo MAL",r),o({existe:!0})}))}))}},{key:"cargarFormulario",value:function(){this.registroForm=new s.c({nombre:new s.a(null,[s.m.required,s.m.minLength(6)]),apellidos:new s.a(null,[s.m.required,s.m.minLength(6)]),correo:new s.a(null,[s.m.required,s.m.minLength(6)]),rfc:new s.a(null,[s.m.required,s.m.minLength(4),s.m.maxLength(18),s.m.pattern("^[A-Z0-9_.-]*$")],this.rfcUnico.bind(this)),idrol:new s.a(1,s.m.required),password:new s.a(null,[s.m.required,s.m.minLength(5)]),password2:new s.a(null,[s.m.required,s.m.min(5)])},{validators:this.compararContras})}},{key:"compararContras",value:function(o){return o.controls.password2.value===o.controls.password.value?null:{mismatch:!0}}}]),r}()).\u0275fac=function(o){return new(o||w)(g.Hb(b.a),g.Hb(c.U),g.Hb(l.f))},w.\u0275cmp=g.Bb({type:w,selectors:[["app-signup"]],decls:53,vars:7,consts:[[1,"ion-text-center"],[3,"formGroup"],["position","floating"],["color","danger"],["required","","formControlName","nombre","type","text"],["required","","formControlName","apellidos","type","text"],["required","","formControlName","correo","type","text"],["debounce","1000","required","","formControlName","rfc","oninput","this.value = this.value.toUpperCase()","type","text"],["color","danger",4,"ngIf"],["color","success",4,"ngIf"],["formControlName","idrol","interface","popover","placeholder","Roles",3,"value"],[3,"value",4,"ngFor","ngForOf"],["required","","formControlName","password","type","password"],["formControlName","password2","type","password"],["expand","full","color","primary",3,"disabled","click"],[4,"ngIf"],["color","danger","mode","ios"],["color","success"],["color","success","mode","ios"],[3,"value"]],template:function(o,r){1&o&&(g.Kb(0,"ion-header"),g.Kb(1,"ion-toolbar",0),g.Kb(2,"ion-title"),g.gc(3,"Registro"),g.Jb(),g.Jb(),g.Jb(),g.Kb(4,"ion-content"),g.Kb(5,"ion-card"),g.Kb(6,"form",1),g.Kb(7,"ion-item"),g.Kb(8,"ion-label",2),g.gc(9,"Nombres "),g.Kb(10,"ion-text",3),g.gc(11,"*"),g.Jb(),g.Jb(),g.Ib(12,"ion-input",4),g.Jb(),g.Kb(13,"ion-item"),g.Kb(14,"ion-label",2),g.gc(15,"Apellidos "),g.Kb(16,"ion-text",3),g.gc(17,"*"),g.Jb(),g.Jb(),g.Ib(18,"ion-input",5),g.Jb(),g.Kb(19,"ion-item"),g.Kb(20,"ion-label",2),g.gc(21,"Correo electronico "),g.Kb(22,"ion-text",3),g.gc(23,"*"),g.Jb(),g.Jb(),g.Ib(24,"ion-input",6),g.Jb(),g.Kb(25,"ion-item"),g.Kb(26,"ion-label",2),g.gc(27,"RFC o numero de agente"),g.Kb(28,"ion-text",3),g.gc(29,"*"),g.Jb(),g.Jb(),g.Ib(30,"ion-input",7),g.fc(31,h,6,1,"ion-text",8),g.fc(32,J,5,0,"ion-text",9),g.Jb(),g.Kb(33,"ion-item"),g.Kb(34,"ion-label"),g.gc(35,"Selecciona tu rol"),g.Jb(),g.Kb(36,"ion-select",10),g.fc(37,v,2,2,"ion-select-option",11),g.Jb(),g.Jb(),g.Kb(38,"ion-item"),g.Kb(39,"ion-label",2),g.gc(40,"Contrasena "),g.Kb(41,"ion-text",3),g.gc(42,"*"),g.Jb(),g.Jb(),g.Ib(43,"ion-input",12),g.Jb(),g.Kb(44,"ion-item"),g.Kb(45,"ion-label",2),g.gc(46,"Repite tu contrasena "),g.Kb(47,"ion-text",3),g.gc(48,"*"),g.Jb(),g.Jb(),g.Ib(49,"ion-input",13),g.fc(50,K,3,0,"ion-text",8),g.Jb(),g.Jb(),g.Kb(51,"ion-button",14),g.Sb("click",(function(){return r.registrarce()})),g.gc(52," Registrarce\n"),g.Jb(),g.Jb(),g.Jb()),2&o&&(g.xb(6),g.Zb("formGroup",r.registroForm),g.xb(25),g.Zb("ngIf",null==r.registroForm.controls.rfc.errors?null:r.registroForm.controls.rfc.errors.existe),g.xb(1),g.Zb("ngIf",r.registroForm.controls.rfc.valid),g.xb(4),g.Zb("value",1),g.xb(1),g.Zb("ngForOf",r.roles),g.xb(13),g.Zb("ngIf",(null==r.registroForm.errors?null:r.registroForm.errors.mismatch)&&(r.registroForm.controls.password2.dirty||r.registroForm.controls.password2.touched)),g.xb(1),g.Zb("disabled",r.registroForm.invalid))},directives:[c.s,c.L,c.K,c.n,c.h,s.n,s.i,s.d,c.v,c.w,c.J,c.u,c.T,s.l,s.h,s.b,a.j,c.D,c.S,a.i,c.f,c.e,c.E],styles:[""]}),w),C=[{path:"",component:(y=function(){function r(){o(this,r)}return e(r,[{key:"ngOnInit",value:function(){}}]),r}(),y.\u0275fac=function(o){return new(o||y)},y.\u0275cmp=g.Bb({type:y,selectors:[["app-inicio"]],decls:10,vars:0,consts:[["slot","bottom,top"],["tab","login"],["name","person-circle"],["tab","signup"],["name","create"]],template:function(o,r){1&o&&(g.Kb(0,"ion-tabs"),g.Kb(1,"ion-tab-bar",0),g.Kb(2,"ion-tab-button",1),g.Ib(3,"ion-icon",2),g.Kb(4,"ion-label"),g.gc(5,"Iniciar sesion"),g.Jb(),g.Jb(),g.Kb(6,"ion-tab-button",3),g.Ib(7,"ion-icon",4),g.Kb(8,"ion-label"),g.gc(9,"Registrate"),g.Jb(),g.Jb(),g.Jb(),g.Jb())},directives:[c.I,c.G,c.H,c.t,c.w],styles:[""]}),y),children:[{path:"",redirectTo:"login",pathMatch:"full"},{path:"login",component:d},{path:"signup",component:I}]}],k=((F=function r(){o(this,r)}).\u0275mod=g.Fb({type:F}),F.\u0275inj=g.Eb({factory:function(o){return new(o||F)},imports:[[l.h.forChild(C)],l.h]}),F),U=((x=function r(){o(this,r)}).\u0275mod=g.Fb({type:x}),x.\u0275inj=g.Eb({factory:function(o){return new(o||x)},imports:[[a.b,s.e,c.N,s.k,b.b,k]]}),x)}}])}();