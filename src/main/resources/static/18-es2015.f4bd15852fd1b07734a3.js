(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{JJEo:function(o,r,t){"use strict";t.r(r),t.d(r,"InicioPageModule",(function(){return v}));var e=t("ofXK"),i=t("3Pt+"),n=t("TEn/"),s=t("tyNb"),a=t("mrSG"),l=t("tk/3"),c=t("AytR"),b=t("fXoL"),u=t("lGQG");let m=(()=>{class o{constructor(o,r,t,e){this.http=o,this.auth=r,this.toastCtrl=t,this.router=e}ngOnInit(){this.cargarForm()}cargarForm(){this.loginForm=new i.c({rfc:new i.a(null,i.m.required),password:new i.a(null,[i.m.required,i.m.minLength(5)])})}iniciarSesion(){const o=(new l.c).set("rfc",this.loginForm.value.rfc).set("password",this.loginForm.value.password);this.http.get(c.a.apiUrl+"/usuario/login",{params:o}).toPromise().then(o=>{if(1==o.data.length)switch(this.auth.usuario=o.data[0],localStorage.setItem("cuenta",JSON.stringify(this.auth.usuario)),this.mostrarToast("Bienvenido "+this.auth.usuario.nombre,"success"),this.auth.usuario.idrol.id){case 1:this.router.navigateByUrl("usuario",{replaceUrl:!0});break;case 2:this.router.navigateByUrl("admin",{replaceUrl:!0});break;default:this.router.navigateByUrl("agente",{replaceUrl:!0})}else this.mostrarToast("Error : datos incorrectos","danger");console.log("Resp al iniciar sesion",o)}).catch(o=>{this.mostrarToast("Error : datos incorrectos","danger"),console.log("Error al iniciar sesion",o)})}mostrarToast(o,r){return Object(a.b)(this,void 0,void 0,(function*(){return(yield this.toastCtrl.create({message:o,color:r,duration:3e3})).present()}))}}return o.\u0275fac=function(r){return new(r||o)(b.Hb(l.a),b.Hb(u.a),b.Hb(n.U),b.Hb(s.f))},o.\u0275cmp=b.Bb({type:o,selectors:[["app-login"]],decls:24,vars:2,consts:[[1,"ion-text-center"],[2,"padding-left","10%","padding-right","10%"],[3,"formGroup","ngSubmit"],["position","floating"],["color","danger"],["formControlName","rfc","oninput","this.value = this.value.toUpperCase()","type","text","type","text"],["formControlName","password","type","password"],["mode","ios","expand","full","color","primary","type","submit",3,"disabled"]],template:function(o,r){1&o&&(b.Kb(0,"ion-header"),b.Kb(1,"ion-toolbar",0),b.Kb(2,"ion-title"),b.gc(3,"Autententiciacion"),b.Jb(),b.Jb(),b.Jb(),b.Kb(4,"ion-content"),b.Kb(5,"ion-card",1),b.Kb(6,"ion-card-header",0),b.Kb(7,"ion-card-title"),b.gc(8,"Ingresa tus datos"),b.Jb(),b.Jb(),b.Kb(9,"form",2),b.Sb("ngSubmit",(function(){return r.iniciarSesion()})),b.Kb(10,"ion-item"),b.Kb(11,"ion-label",3),b.gc(12,"RFC "),b.Kb(13,"ion-text",4),b.gc(14,"*"),b.Jb(),b.Jb(),b.Ib(15,"ion-input",5),b.Jb(),b.Kb(16,"ion-item"),b.Kb(17,"ion-label",3),b.gc(18,"Contrasena "),b.Kb(19,"ion-text",4),b.gc(20,"*"),b.Jb(),b.Jb(),b.Ib(21,"ion-input",6),b.Jb(),b.Kb(22,"ion-button",7),b.gc(23," Iniciar sesion "),b.Jb(),b.Jb(),b.Jb(),b.Jb()),2&o&&(b.xb(9),b.Zb("formGroup",r.loginForm),b.xb(13),b.Zb("disabled",r.loginForm.invalid))},directives:[n.s,n.L,n.K,n.n,n.h,n.j,n.k,i.n,i.i,i.d,n.v,n.w,n.J,n.u,n.T,i.h,i.b,n.f],styles:[""]}),o})();function g(o,r){1&o&&(b.Kb(0,"p"),b.gc(1,"El RFC es necesario"),b.Jb())}function d(o,r){if(1&o&&(b.Kb(0,"ion-text",3),b.fc(1,g,2,0,"p",15),b.Kb(2,"p"),b.gc(3," El RFC "),b.Kb(4,"ion-badge",16),b.gc(5,"NO ESTA disponible"),b.Jb(),b.Jb(),b.Jb()),2&o){const o=b.Ub();b.xb(1),b.Zb("ngIf",(null==o.registroForm.controls.rfc.errors?null:o.registroForm.controls.rfc.errors.required)&&o.registroForm.controls.rfc.dirty)}}function p(o,r){1&o&&(b.Kb(0,"ion-text",17),b.Kb(1,"p"),b.gc(2," El RFC esta "),b.Kb(3,"ion-badge",18),b.gc(4,"DISPONIBLE"),b.Jb(),b.Jb(),b.Jb())}function h(o,r){if(1&o&&(b.Kb(0,"ion-select-option",19),b.gc(1),b.Jb()),2&o){const o=r.$implicit;b.Zb("value",o.id),b.xb(1),b.hc(o.rol)}}function f(o,r){1&o&&(b.Kb(0,"ion-text",3),b.Kb(1,"p"),b.gc(2,"Las contrase\xf1as NO son iguales"),b.Jb(),b.Jb())}let J=(()=>{class o{constructor(o,r,t){this.http=o,this.toastCtrl=r,this.router=t,this.roles=[{id:1,rol:"Usuario"},{id:3,rol:"Agente"}]}ngOnInit(){this.cargarFormulario()}registrarce(){const o={nombre:this.registroForm.controls.nombre.value,apellidos:this.registroForm.controls.apellidos.value,correo:this.registroForm.controls.correo.value,rfc:this.registroForm.controls.rfc.value,password:this.registroForm.controls.password2.value,idrol:{id:this.registroForm.controls.idrol.value}};console.log("El usuario seria",o),this.http.post(c.a.apiUrl+"/usuario",o).subscribe(o=>{o.success?(this.mostrarToast("Se registro correctamente","success"),this.registroForm.reset({nombre:null,apellidos:null,correo:null,rfc:null,idrol:1,password:null,password2:null}),this.router.navigateByUrl("inicio/login")):this.mostrarToast("Algo salio mal","danger"),console.log("Resp al crear usuario",o)},o=>console.log("Ocurrio un error al crear el usuario",o))}mostrarToast(o,r){return Object(a.b)(this,void 0,void 0,(function*(){return(yield this.toastCtrl.create({message:o,color:r,duration:3e3})).present()}))}rfcUnico(o){return new Promise((o,r)=>{this.http.get(`${c.a.apiUrl}/usuario/rfcValidacion/?rfc=${this.registroForm.controls.rfc.value}`).subscribe(r=>{console.log("Se hizo bien",r),o(1==r.data.length?{existe:!0}:null)},r=>{console.log("Se hizo MAL",r),o({existe:!0})})})}cargarFormulario(){this.registroForm=new i.c({nombre:new i.a(null,[i.m.required,i.m.minLength(6)]),apellidos:new i.a(null,[i.m.required,i.m.minLength(6)]),correo:new i.a(null,[i.m.required,i.m.minLength(6)]),rfc:new i.a(null,[i.m.required,i.m.minLength(4),i.m.maxLength(18),i.m.pattern("^[A-Z0-9_.-]*$")],this.rfcUnico.bind(this)),idrol:new i.a(1,i.m.required),password:new i.a(null,[i.m.required,i.m.minLength(5)]),password2:new i.a(null,[i.m.required,i.m.min(5)])},{validators:this.compararContras})}compararContras(o){return o.controls.password2.value===o.controls.password.value?null:{mismatch:!0}}}return o.\u0275fac=function(r){return new(r||o)(b.Hb(l.a),b.Hb(n.U),b.Hb(s.f))},o.\u0275cmp=b.Bb({type:o,selectors:[["app-signup"]],decls:53,vars:7,consts:[[1,"ion-text-center"],[3,"formGroup"],["position","floating"],["color","danger"],["required","","formControlName","nombre","type","text"],["required","","formControlName","apellidos","type","text"],["required","","formControlName","correo","type","text"],["debounce","1000","required","","formControlName","rfc","oninput","this.value = this.value.toUpperCase()","type","text"],["color","danger",4,"ngIf"],["color","success",4,"ngIf"],["formControlName","idrol","interface","popover","placeholder","Roles",3,"value"],[3,"value",4,"ngFor","ngForOf"],["required","","formControlName","password","type","password"],["formControlName","password2","type","password"],["expand","full","color","primary",3,"disabled","click"],[4,"ngIf"],["color","danger","mode","ios"],["color","success"],["color","success","mode","ios"],[3,"value"]],template:function(o,r){1&o&&(b.Kb(0,"ion-header"),b.Kb(1,"ion-toolbar",0),b.Kb(2,"ion-title"),b.gc(3,"Registro"),b.Jb(),b.Jb(),b.Jb(),b.Kb(4,"ion-content"),b.Kb(5,"ion-card"),b.Kb(6,"form",1),b.Kb(7,"ion-item"),b.Kb(8,"ion-label",2),b.gc(9,"Nombres "),b.Kb(10,"ion-text",3),b.gc(11,"*"),b.Jb(),b.Jb(),b.Ib(12,"ion-input",4),b.Jb(),b.Kb(13,"ion-item"),b.Kb(14,"ion-label",2),b.gc(15,"Apellidos "),b.Kb(16,"ion-text",3),b.gc(17,"*"),b.Jb(),b.Jb(),b.Ib(18,"ion-input",5),b.Jb(),b.Kb(19,"ion-item"),b.Kb(20,"ion-label",2),b.gc(21,"Correo electronico "),b.Kb(22,"ion-text",3),b.gc(23,"*"),b.Jb(),b.Jb(),b.Ib(24,"ion-input",6),b.Jb(),b.Kb(25,"ion-item"),b.Kb(26,"ion-label",2),b.gc(27,"RFC o numero de agente"),b.Kb(28,"ion-text",3),b.gc(29,"*"),b.Jb(),b.Jb(),b.Ib(30,"ion-input",7),b.fc(31,d,6,1,"ion-text",8),b.fc(32,p,5,0,"ion-text",9),b.Jb(),b.Kb(33,"ion-item"),b.Kb(34,"ion-label"),b.gc(35,"Selecciona tu rol"),b.Jb(),b.Kb(36,"ion-select",10),b.fc(37,h,2,2,"ion-select-option",11),b.Jb(),b.Jb(),b.Kb(38,"ion-item"),b.Kb(39,"ion-label",2),b.gc(40,"Contrasena "),b.Kb(41,"ion-text",3),b.gc(42,"*"),b.Jb(),b.Jb(),b.Ib(43,"ion-input",12),b.Jb(),b.Kb(44,"ion-item"),b.Kb(45,"ion-label",2),b.gc(46,"Repite tu contrasena "),b.Kb(47,"ion-text",3),b.gc(48,"*"),b.Jb(),b.Jb(),b.Ib(49,"ion-input",13),b.fc(50,f,3,0,"ion-text",8),b.Jb(),b.Jb(),b.Kb(51,"ion-button",14),b.Sb("click",(function(){return r.registrarce()})),b.gc(52," Registrarce\n"),b.Jb(),b.Jb(),b.Jb()),2&o&&(b.xb(6),b.Zb("formGroup",r.registroForm),b.xb(25),b.Zb("ngIf",null==r.registroForm.controls.rfc.errors?null:r.registroForm.controls.rfc.errors.existe),b.xb(1),b.Zb("ngIf",r.registroForm.controls.rfc.valid),b.xb(4),b.Zb("value",1),b.xb(1),b.Zb("ngForOf",r.roles),b.xb(13),b.Zb("ngIf",(null==r.registroForm.errors?null:r.registroForm.errors.mismatch)&&(r.registroForm.controls.password2.dirty||r.registroForm.controls.password2.touched)),b.xb(1),b.Zb("disabled",r.registroForm.invalid))},directives:[n.s,n.L,n.K,n.n,n.h,i.n,i.i,i.d,n.v,n.w,n.J,n.u,n.T,i.l,i.h,i.b,e.j,n.D,n.S,e.i,n.f,n.e,n.E],styles:[""]}),o})();const K=[{path:"",component:(()=>{class o{constructor(){}ngOnInit(){}}return o.\u0275fac=function(r){return new(r||o)},o.\u0275cmp=b.Bb({type:o,selectors:[["app-inicio"]],decls:10,vars:0,consts:[["slot","bottom,top"],["tab","login"],["name","person-circle"],["tab","signup"],["name","create"]],template:function(o,r){1&o&&(b.Kb(0,"ion-tabs"),b.Kb(1,"ion-tab-bar",0),b.Kb(2,"ion-tab-button",1),b.Ib(3,"ion-icon",2),b.Kb(4,"ion-label"),b.gc(5,"Iniciar sesion"),b.Jb(),b.Jb(),b.Kb(6,"ion-tab-button",3),b.Ib(7,"ion-icon",4),b.Kb(8,"ion-label"),b.gc(9,"Registrate"),b.Jb(),b.Jb(),b.Jb(),b.Jb())},directives:[n.I,n.G,n.H,n.t,n.w],styles:[""]}),o})(),children:[{path:"",redirectTo:"login",pathMatch:"full"},{path:"login",component:m},{path:"signup",component:J}]}];let w=(()=>{class o{}return o.\u0275mod=b.Fb({type:o}),o.\u0275inj=b.Eb({factory:function(r){return new(r||o)},imports:[[s.h.forChild(K)],s.h]}),o})(),v=(()=>{class o{}return o.\u0275mod=b.Fb({type:o}),o.\u0275inj=b.Eb({factory:function(r){return new(r||o)},imports:[[e.b,i.e,n.N,i.k,l.b,w]]}),o})()}}]);