!function(){function e(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}function o(e,o){for(var t=0;t<o.length;t++){var r=o[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{JJEo:function(o,r,n){"use strict";n.r(r),n.d(r,"InicioPageModule",(function(){return I}));var i,a=n("ofXK"),s=n("3Pt+"),c=n("TEn/"),l=n("tyNb"),u=n("mrSG"),b=n("tk/3"),m=n("AytR"),g=n("fXoL"),p=n("lGQG"),d=((i=function(){function o(t,r,n,i){e(this,o),this.http=t,this.auth=r,this.toastCtrl=n,this.router=i}return t(o,[{key:"ngOnInit",value:function(){this.cargarForm()}},{key:"cargarForm",value:function(){this.loginForm=new s.c({rfc:new s.a(null,s.m.required),password:new s.a(null,[s.m.required,s.m.minLength(5)])})}},{key:"iniciarSesion",value:function(){var e=this,o=(new b.c).set("rfc",this.loginForm.value.rfc).set("password",this.loginForm.value.password);this.http.get(m.a.apiUrl+"/usuario/login",{params:o}).toPromise().then((function(o){if(1==o.data.length)switch(e.auth.usuario=o.data[0],localStorage.setItem("cuenta",JSON.stringify(e.auth.usuario)),e.mostrarToast("Bienvenido "+e.auth.usuario.nombre,"success"),e.auth.usuario.idrol.id){case 1:e.router.navigateByUrl("usuario",{replaceUrl:!0});break;case 2:e.router.navigateByUrl("admin",{replaceUrl:!0});break;default:e.router.navigateByUrl("agente",{replaceUrl:!0})}else e.mostrarToast("Error : datos incorrectos","danger");console.log("Resp al iniciar sesion",o)})).catch((function(o){e.mostrarToast("Error : datos incorrectos","danger"),console.log("Error al iniciar sesion",o)}))}},{key:"mostrarToast",value:function(e,o){return Object(u.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.toastCtrl.create({message:e,color:o,duration:3e3});case 2:return t.abrupt("return",t.sent.present());case 3:case"end":return t.stop()}}),t,this)})))}}]),o}()).\u0275fac=function(e){return new(e||i)(g.Hb(b.a),g.Hb(p.a),g.Hb(c.S),g.Hb(l.f))},i.\u0275cmp=g.Bb({type:i,selectors:[["app-login"]],decls:24,vars:2,consts:[[1,"ion-text-center"],[2,"padding-left","10%","padding-right","10%"],[3,"formGroup","ngSubmit"],["position","floating"],["color","danger"],["formControlName","rfc","oninput","this.value = this.value.toUpperCase()","type","text","type","text"],["formControlName","password","type","password"],["mode","ios","expand","full","color","primary","type","submit",3,"disabled"]],template:function(e,o){1&e&&(g.Kb(0,"ion-header"),g.Kb(1,"ion-toolbar",0),g.Kb(2,"ion-title"),g.gc(3,"Autententiciacion"),g.Jb(),g.Jb(),g.Jb(),g.Kb(4,"ion-content"),g.Kb(5,"ion-card",1),g.Kb(6,"ion-card-header",0),g.Kb(7,"ion-card-title"),g.gc(8,"Ingresa tus datos"),g.Jb(),g.Jb(),g.Kb(9,"form",2),g.Sb("ngSubmit",(function(){return o.iniciarSesion()})),g.Kb(10,"ion-item"),g.Kb(11,"ion-label",3),g.gc(12,"RFC "),g.Kb(13,"ion-text",4),g.gc(14,"*"),g.Jb(),g.Jb(),g.Ib(15,"ion-input",5),g.Jb(),g.Kb(16,"ion-item"),g.Kb(17,"ion-label",3),g.gc(18,"Contrasena "),g.Kb(19,"ion-text",4),g.gc(20,"*"),g.Jb(),g.Jb(),g.Ib(21,"ion-input",6),g.Jb(),g.Kb(22,"ion-button",7),g.gc(23," Iniciar sesion "),g.Jb(),g.Jb(),g.Jb(),g.Jb()),2&e&&(g.xb(9),g.Zb("formGroup",o.loginForm),g.xb(13),g.Zb("disabled",o.loginForm.invalid))},directives:[c.q,c.J,c.I,c.n,c.h,c.j,c.k,s.n,s.i,s.d,c.t,c.u,c.H,c.s,c.R,s.h,s.b,c.f],styles:[""]}),i),f=n("lJxs");function h(e,o){1&e&&(g.Kb(0,"ion-text",13),g.Kb(1,"p"),g.gc(2,"Esta disponible"),g.Jb(),g.Jb())}function v(e,o){1&e&&(g.Kb(0,"ion-text",2),g.Kb(1,"p"),g.gc(2,"NO esta disponible"),g.Jb(),g.Jb())}function J(e,o){1&e&&(g.Kb(0,"ion-text",2),g.Kb(1,"p"),g.gc(2,"Las contrase\xf1as NO son iguales"),g.Jb(),g.Jb())}var K,w,y,x,F=((K=function(){function o(t,r,n){e(this,o),this.http=t,this.toastCtrl=r,this.router=n,this.rol=1,this.existe=void 0}return t(o,[{key:"ngOnInit",value:function(){this.cargarFormulario()}},{key:"registrarce",value:function(){var e=this,o={nombre:this.registroForm.controls.nombre.value,apellidos:this.registroForm.controls.apellidos.value,correo:this.registroForm.controls.correo.value,rfc:this.registroForm.controls.rfc.value,password:this.registroForm.controls.password2.value,idrol:{id:this.rol}};console.log("El usuario seria",o),this.http.post(m.a.apiUrl+"/usuario",o).toPromise().then((function(t){if(t.success)return e.mostrarToast("Se registro correctamente","success"),e.enviarEmail({contentType:"text/plain",mailBcc:"",mailCc:"pocholowsd@gmail.com",mailContent:"Te ha registrado corractemente",mailFrom:"mx.notificationes@swissport.com",mailSubject:"Bienvenido "+o.nombre+" "+o.apellidos,mailTo:o.correo});e.mostrarToast("Algo salio mal","danger"),console.log("Resp al crear usuario",t)})).then((function(o){e.router.navigateByUrl("inicio/login"),console.log("Se envio el correo"),e.registroForm.reset({nombre:null,apellidos:null,correo:null,rfc:null,agente:null,password:null,password2:null}),e.existe=void 0})).catch((function(o){e.mostrarToast("Algo salio mal","danger"),console.log("Ocurrio un error al registrar el usuario",o)}))}},{key:"enviarEmail",value:function(e){return this.http.post(m.a.apiUrl+"/sendEmails",e).toPromise()}},{key:"mostrarToast",value:function(e,o){return Object(u.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.toastCtrl.create({message:e,color:o,duration:3e3});case 2:return t.abrupt("return",t.sent.present());case 3:case"end":return t.stop()}}),t,this)})))}},{key:"validarRfc",value:function(e){return this.http.get("".concat(m.a.apiUrl,"/usuario/rfcValidacion/?rfc=").concat(e)).pipe(Object(f.a)((function(e){return console.log("La resp",e),1==e.data.length}))).toPromise()}},{key:"validarEntrada",value:function(e){var o=this;e.length>=4&&e.length<=6?(console.log("Parece agente"),this.validarRfc(e).then((function(t){console.log("Que sale",t),t?(o.existe=!0,o.registroForm.controls.rfc.reset(null)):(o.registroForm.controls.rfc.setValue(e),o.existe=!1,o.rol=3)})).catch((function(e){console.log("Error al verificar rfc",e)}))):12!=e.length&&13!=e.length||(console.log("parece rfc"),this.validarRfc(e).then((function(t){t?(o.existe=!0,o.registroForm.controls.rfc.reset(null)):(o.registroForm.controls.rfc.setValue(e),o.existe=!1,o.rol=1)})).catch((function(e){console.log("Error al verificar rfc",e)})))}},{key:"verForm",value:function(){console.log(this.registroForm)}},{key:"cargarFormulario",value:function(){this.registroForm=new s.c({nombre:new s.a(null,[s.m.required,s.m.minLength(6)]),apellidos:new s.a(null,[s.m.required,s.m.minLength(6)]),correo:new s.a(null,[s.m.required,s.m.minLength(6)]),rfc:new s.a(null,[s.m.required,s.m.minLength(4),s.m.maxLength(13)]),password:new s.a(null,[s.m.required,s.m.minLength(5)]),password2:new s.a(null,[s.m.required,s.m.min(5)])},{validators:this.compararContras})}},{key:"compararContras",value:function(e){return e.controls.password2.value===e.controls.password.value?null:{mismatch:!0}}}]),o}()).\u0275fac=function(e){return new(e||K)(g.Hb(b.a),g.Hb(c.S),g.Hb(l.f))},K.\u0275cmp=g.Bb({type:K,selectors:[["app-signup"]],decls:48,vars:5,consts:[[1,"ion-text-center"],["position","floating"],["color","danger"],["debounce","1000","required","","oninput","this.value = this.value.toUpperCase()","type","text",3,"ionChange"],["color","success",4,"ngIf"],["color","danger",4,"ngIf"],[3,"formGroup"],["required","","formControlName","nombre","type","text"],["required","","formControlName","apellidos","type","text"],["required","","formControlName","correo","type","text"],["required","","formControlName","password","type","password"],["formControlName","password2","type","password"],["expand","full","color","primary",3,"disabled","click"],["color","success"]],template:function(e,o){1&e&&(g.Kb(0,"ion-header"),g.Kb(1,"ion-toolbar",0),g.Kb(2,"ion-title"),g.gc(3,"Registro"),g.Jb(),g.Jb(),g.Jb(),g.Kb(4,"ion-content"),g.Kb(5,"ion-card"),g.Kb(6,"ion-item"),g.Kb(7,"ion-label",1),g.gc(8,"RFC o numero de agente"),g.Kb(9,"ion-text",2),g.gc(10,"*"),g.Jb(),g.Jb(),g.Kb(11,"ion-input",3),g.Sb("ionChange",(function(e){return o.validarEntrada(e.target.value)})),g.Jb(),g.fc(12,h,3,0,"ion-text",4),g.fc(13,v,3,0,"ion-text",5),g.Jb(),g.Kb(14,"form",6),g.Kb(15,"ion-item"),g.Kb(16,"ion-label",1),g.gc(17,"Nombres "),g.Kb(18,"ion-text",2),g.gc(19,"*"),g.Jb(),g.Jb(),g.Ib(20,"ion-input",7),g.Jb(),g.Kb(21,"ion-item"),g.Kb(22,"ion-label",1),g.gc(23,"Apellidos "),g.Kb(24,"ion-text",2),g.gc(25,"*"),g.Jb(),g.Jb(),g.Ib(26,"ion-input",8),g.Jb(),g.Kb(27,"ion-item"),g.Kb(28,"ion-label",1),g.gc(29,"Correo electronico "),g.Kb(30,"ion-text",2),g.gc(31,"*"),g.Jb(),g.Jb(),g.Ib(32,"ion-input",9),g.Jb(),g.Kb(33,"ion-item"),g.Kb(34,"ion-label",1),g.gc(35,"Contrasena "),g.Kb(36,"ion-text",2),g.gc(37,"*"),g.Jb(),g.Jb(),g.Ib(38,"ion-input",10),g.Jb(),g.Kb(39,"ion-item"),g.Kb(40,"ion-label",1),g.gc(41,"Repite tu contrasena "),g.Kb(42,"ion-text",2),g.gc(43,"*"),g.Jb(),g.Jb(),g.Ib(44,"ion-input",11),g.fc(45,J,3,0,"ion-text",5),g.Jb(),g.Jb(),g.Kb(46,"ion-button",12),g.Sb("click",(function(){return o.registrarce()})),g.gc(47," Registrate\n"),g.Jb(),g.Jb(),g.Jb()),2&e&&(g.xb(12),g.Zb("ngIf",null!=o.existe&&!o.existe),g.xb(1),g.Zb("ngIf",o.existe),g.xb(1),g.Zb("formGroup",o.registroForm),g.xb(31),g.Zb("ngIf",(null==o.registroForm.errors?null:o.registroForm.errors.mismatch)&&(o.registroForm.controls.password2.dirty||o.registroForm.controls.password2.touched)),g.xb(1),g.Zb("disabled",o.registroForm.invalid))},directives:[c.q,c.J,c.I,c.n,c.h,c.t,c.u,c.H,c.s,c.R,a.j,s.n,s.i,s.d,s.l,s.h,s.b,c.f],styles:[""]}),K),k=[{path:"",component:(w=function(){function o(){e(this,o)}return t(o,[{key:"ngOnInit",value:function(){}}]),o}(),w.\u0275fac=function(e){return new(e||w)},w.\u0275cmp=g.Bb({type:w,selectors:[["app-inicio"]],decls:10,vars:0,consts:[["slot","bottom,top"],["tab","login"],["name","person-circle"],["tab","signup"],["name","create"]],template:function(e,o){1&e&&(g.Kb(0,"ion-tabs"),g.Kb(1,"ion-tab-bar",0),g.Kb(2,"ion-tab-button",1),g.Ib(3,"ion-icon",2),g.Kb(4,"ion-label"),g.gc(5,"Iniciar sesion"),g.Jb(),g.Jb(),g.Kb(6,"ion-tab-button",3),g.Ib(7,"ion-icon",4),g.Kb(8,"ion-label"),g.gc(9,"Registrate"),g.Jb(),g.Jb(),g.Jb(),g.Jb())},directives:[c.G,c.E,c.F,c.r,c.u],styles:[""]}),w),children:[{path:"",redirectTo:"login",pathMatch:"full"},{path:"login",component:d},{path:"signup",component:F}]}],C=((x=function o(){e(this,o)}).\u0275mod=g.Fb({type:x}),x.\u0275inj=g.Eb({factory:function(e){return new(e||x)},imports:[[l.h.forChild(k)],l.h]}),x),I=((y=function o(){e(this,o)}).\u0275mod=g.Fb({type:y}),y.\u0275inj=g.Eb({factory:function(e){return new(e||y)},imports:[[a.b,s.e,c.L,s.k,b.b,C]]}),y)}}])}();