!function(){function e(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,n){if(!e)return;if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return t(e,n)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{"7PqN":function(t,r,a){"use strict";a.r(r),a.d(r,"FacturasTabsPageModule",(function(){return j}));var c=a("ofXK"),i=a("3Pt+"),s=a("TEn/"),l=a("tyNb"),u=a("mrSG"),b=a("AytR"),f=a("fXoL"),d=a("tk/3");function m(e,t){1&e&&(f.Kb(0,"p"),f.gc(1,"El RFC es necesario"),f.Jb())}function h(e,t){if(1&e&&(f.Kb(0,"ion-text",8),f.fc(1,m,2,0,"p",19),f.Kb(2,"p"),f.gc(3," El RFC "),f.Kb(4,"ion-badge",20),f.gc(5,"NO EXISTE"),f.Jb(),f.Jb(),f.Jb()),2&e){var n=f.Ub();f.xb(1),f.Zb("ngIf",(null==n.facturaForm.controls.rfc.errors?null:n.facturaForm.controls.rfc.errors.required)&&n.facturaForm.controls.rfc.dirty)}}function p(e,t){1&e&&(f.Kb(0,"ion-text",21),f.Kb(1,"p"),f.gc(2," El RFC "),f.Kb(3,"ion-badge",22),f.gc(4,"EXISTE"),f.Jb(),f.Jb(),f.Jb())}var g,v=((g=function(){function e(t,r,o){n(this,e),this.modalCtrl=t,this.http=r,this.toastCtrl=o,this.rfc=""}return o(e,[{key:"ngOnInit",value:function(){var e=this;this.cargarFormulario(),this.modalCtrl.getTop().then((function(t){console.log("Los datos recibidos son: ",t.componentProps),e.rfc=t.componentProps.rfc,e.id=t.componentProps.id,e.facturaForm.setValue({agente:t.componentProps.agente,almacen:t.componentProps.almacen,awb:t.componentProps.awb,factura:t.componentProps.factura,hbw:t.componentProps.hbw,pedimento:t.componentProps.pedimento,rfc:t.componentProps.rfc})})).catch((function(e){return console.log("Error al cargar el modal",e)}))}},{key:"cargarFormulario",value:function(){this.facturaForm=new i.c({agente:new i.a(null,i.m.required),almacen:new i.a(null,i.m.required),awb:new i.a(null,i.m.required),factura:new i.a(null,i.m.required),hbw:new i.a(null,i.m.required),pedimento:new i.a(null,i.m.required),rfc:new i.a(null,i.m.required,this.rfcUnico.bind(this))})}},{key:"editarFactura",value:function(){var e=this,t=Object.assign(Object.assign({},this.facturaForm.value),{fecha:(new Date).toISOString(),id:this.id});this.http.put(b.a.apiUrl+"/facturas",t).subscribe((function(t){console.log("Resp de actualizar factura",t),t.success?e.cerrarModal(!0,t.data):e.mostrarToast("Error al crear la factura","danger")}),(function(t){e.mostrarToast("Error al crear la factura","danger"),console.log("Error al crear la factura",t)})),console.log("La factura final sera",t)}},{key:"cerrarModal",value:function(e,t){this.modalCtrl.dismiss({completado:e,nuevo:t})}},{key:"rfcUnico",value:function(e){var t=this;return new Promise((function(e,n){return Object(u.b)(t,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.http.get("".concat(b.a.apiUrl,"/usuario/rfc/?rfc=").concat(this.facturaForm.controls.rfc.value)).subscribe((function(t){console.log("Se hizo bien",t),e(1==t.data.length?null:{existe:!0})}),(function(t){console.log("Se hizo MAL",t),e({existe:!0})}));case 2:case"end":return t.stop()}}),t,this)})))}))}},{key:"mostrarToast",value:function(e,t){return Object(u.b)(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.toastCtrl.create({message:e,color:t,duration:3e3});case 2:return n.abrupt("return",n.sent.present());case 3:case"end":return n.stop()}}),n,this)})))}}]),e}()).\u0275fac=function(e){return new(e||g)(f.Hb(s.Q),f.Hb(d.a),f.Hb(s.U))},g.\u0275cmp=f.Bb({type:g,selectors:[["app-editar-factura"]],decls:71,vars:5,consts:[[1,"ion-text-center"],["slot","start"],["color","dark",3,"click"],["name","chevron-back-circle"],[3,"formGroup","ngSubmit"],["fixed",""],["size","6"],["position","floating"],["color","danger"],["required","","formControlName","agente","type","text"],["required","","formControlName","almacen","type","text"],["required","","formControlName","awb","type","text"],["required","","formControlName","factura","type","text"],["required","","formControlName","hbw","type","text"],["required","","formControlName","pedimento","type","text"],["required","","formControlName","rfc","type","text","oninput","this.value = this.value.toUpperCase()","type","text"],["color","danger",4,"ngIf"],["color","success",4,"ngIf"],["type","submit","expand","full",3,"disabled"],[4,"ngIf"],["color","danger","mode","ios"],["color","success"],["color","success","mode","ios"]],template:function(e,t){1&e&&(f.Kb(0,"ion-header"),f.Kb(1,"ion-toolbar",0),f.Kb(2,"ion-buttons",1),f.Kb(3,"ion-button",2),f.Sb("click",(function(){return t.cerrarModal(!1)})),f.Ib(4,"ion-icon",3),f.gc(5," Cancelar "),f.Jb(),f.Jb(),f.Kb(6,"ion-title"),f.gc(7),f.Jb(),f.Jb(),f.Jb(),f.Kb(8,"ion-content"),f.Kb(9,"ion-card"),f.Kb(10,"ion-card-header",0),f.Kb(11,"ion-card-title"),f.gc(12,"Ingresa los nuevos datos "),f.Jb(),f.Jb(),f.Kb(13,"ion-card-content"),f.Kb(14,"form",4),f.Sb("ngSubmit",(function(){return t.editarFactura()})),f.Kb(15,"ion-grid",5),f.Kb(16,"ion-row"),f.Kb(17,"ion-col",6),f.Kb(18,"ion-item"),f.Kb(19,"ion-label",7),f.gc(20,"Agente "),f.Kb(21,"ion-text",8),f.gc(22,"*"),f.Jb(),f.Jb(),f.Ib(23,"ion-input",9),f.Jb(),f.Jb(),f.Kb(24,"ion-col",6),f.Kb(25,"ion-item"),f.Kb(26,"ion-label",7),f.gc(27,"Almacen "),f.Kb(28,"ion-text",8),f.gc(29,"*"),f.Jb(),f.Jb(),f.Ib(30,"ion-input",10),f.Jb(),f.Jb(),f.Jb(),f.Kb(31,"ion-row"),f.Kb(32,"ion-col",6),f.Kb(33,"ion-item"),f.Kb(34,"ion-label",7),f.gc(35,"AWB "),f.Kb(36,"ion-text",8),f.gc(37,"*"),f.Jb(),f.Jb(),f.Ib(38,"ion-input",11),f.Jb(),f.Jb(),f.Kb(39,"ion-col",6),f.Kb(40,"ion-item"),f.Kb(41,"ion-label",7),f.gc(42,"Factura "),f.Kb(43,"ion-text",8),f.gc(44,"*"),f.Jb(),f.Jb(),f.Ib(45,"ion-input",12),f.Jb(),f.Jb(),f.Jb(),f.Kb(46,"ion-row"),f.Kb(47,"ion-col",6),f.Kb(48,"ion-item"),f.Kb(49,"ion-label",7),f.gc(50,"HBW "),f.Kb(51,"ion-text",8),f.gc(52,"*"),f.Jb(),f.Jb(),f.Ib(53,"ion-input",13),f.Jb(),f.Jb(),f.Kb(54,"ion-col",6),f.Kb(55,"ion-item"),f.Kb(56,"ion-label",7),f.gc(57,"Pedimento "),f.Kb(58,"ion-text",8),f.gc(59,"*"),f.Jb(),f.Jb(),f.Ib(60,"ion-input",14),f.Jb(),f.Jb(),f.Jb(),f.Jb(),f.Kb(61,"ion-item"),f.Kb(62,"ion-label",7),f.gc(63,"RFC "),f.Kb(64,"ion-text",8),f.gc(65,"*"),f.Jb(),f.Jb(),f.Ib(66,"ion-input",15),f.fc(67,h,6,1,"ion-text",16),f.fc(68,p,5,0,"ion-text",17),f.Jb(),f.Kb(69,"ion-button",18),f.gc(70," Actualizar factura "),f.Jb(),f.Jb(),f.Jb(),f.Jb(),f.Jb()),2&e&&(f.xb(7),f.ic("RFC ",t.rfc,""),f.xb(7),f.Zb("formGroup",t.facturaForm),f.xb(53),f.Zb("ngIf",null==t.facturaForm.controls.rfc.errors?null:t.facturaForm.controls.rfc.errors.existe),f.xb(1),f.Zb("ngIf",t.facturaForm.controls.rfc.valid),f.xb(1),f.Zb("disabled",t.facturaForm.untouched))},directives:[s.s,s.L,s.g,s.f,s.t,s.K,s.n,s.h,s.j,s.k,s.i,i.n,i.i,i.d,s.r,s.B,s.m,s.v,s.w,s.J,s.u,s.T,i.l,i.h,i.b,c.j,s.e],styles:[""]}),g);function J(e,t){if(1&e&&(f.Kb(0,"p"),f.gc(1),f.Vb(2,"date"),f.Jb()),2&e){var n=f.Ub();f.xb(1),f.hc(f.Wb(2,1,n.fechaInicio))}}function K(e,t){if(1&e&&(f.Kb(0,"p"),f.gc(1),f.Vb(2,"date"),f.Jb()),2&e){var n=f.Ub();f.xb(1),f.hc(f.Wb(2,1,n.fechaFinal))}}function x(e,t){if(1&e){var n=f.Lb();f.Kb(0,"ion-item"),f.Kb(1,"ion-checkbox",11),f.Sb("ngModelChange",(function(e){return f.cc(n),t.$implicit.check=e})),f.Jb(),f.Kb(2,"ion-label"),f.gc(3," RFC "),f.Kb(4,"p"),f.gc(5),f.Jb(),f.Jb(),f.Kb(6,"ion-label"),f.gc(7," Agente "),f.Kb(8,"p"),f.gc(9),f.Jb(),f.Jb(),f.Kb(10,"ion-label"),f.gc(11," Factura "),f.Kb(12,"p"),f.gc(13),f.Jb(),f.Jb(),f.Kb(14,"ion-label"),f.gc(15," pedimento "),f.Kb(16,"p"),f.gc(17),f.Jb(),f.Jb(),f.Kb(18,"ion-label"),f.gc(19," Fecha "),f.Kb(20,"p"),f.gc(21),f.Jb(),f.Jb(),f.Jb()}if(2&e){var r=t.$implicit;f.xb(1),f.Zb("ngModel",r.check),f.xb(4),f.ic(" ",null==r?null:r.rfc," "),f.xb(4),f.ic(" ",null==r?null:r.agente," "),f.xb(4),f.ic(" ",null==r?null:r.factura," "),f.xb(4),f.ic(" ",null==r?null:r.pedimento," "),f.xb(4),f.ic(" ",null==r?null:r.fecha," ")}}var k,y=((k=function(){function t(e,r,o,a){n(this,t),this.http=e,this.toastCtrl=r,this.actionSheetController=o,this.modalCtrl=a,this.facturas=[],this.seleccionados=[],this.pagina=0,this.fechaInicio="",this.fechaFinal=""}return o(t,[{key:"ngOnInit",value:function(){console.log("Empiece")}},{key:"trackByFn",value:function(e,t){return e}},{key:"setFechaInicio",value:function(e){console.log("la fecha inicio es",e),this.fechaInicio=e}},{key:"setFechaFinal",value:function(e){console.log("la fecha final es",e),this.fechaFinal=e}},{key:"cambiarDePagina",value:function(e){var t,n;e?(n=15+(t=15*(this.pagina+1)),this.pagina++):(n=15+(t=15*(this.pagina-1)),this.pagina--),this.facturasPaginada(t,n),console.log("paginado",{inicio:t,final:n})}},{key:"facturasPaginada",value:function(e,t){return this.http.get("".concat(b.a.apiUrl,"/facturas/paginas?rango1=").concat(e,"&rango2=").concat(t)).subscribe((function(n){console.log("De ".concat(e," a ").concat(t),n)}),(function(e){return console.log("Error al traer paginadas",e)}))}},{key:"editarFactura",value:function(t){return Object(u.b)(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.modalCtrl.create({component:v,componentProps:this.facturas[t],backdropDismiss:!1});case 2:return r=n.sent,n.next=5,r.present();case 5:return n.next=7,r.onWillDismiss();case 7:(o=n.sent).data.completado&&(this.mostrarToast("Se gurdo correctamente","success"),console.log("ASi vienen los datos ",o.data),this.facturas[t]=o.data.nuevo,this.facturas=e(this.facturas));case 9:case"end":return n.stop()}}),n,this)})))}},{key:"seleccionar",value:function(){var e=this;this.facturas.forEach((function(t,n){t.check&&e.seleccionados.push({index:n})})),1==this.seleccionados.length?this.mostrarOpcionesIndividual(this.seleccionados[0].index):this.mostrarOpcionesMultiple(),console.log("Seleccionados",this.seleccionados)}},{key:"mostrarOpcionesMultiple",value:function(){return Object(u.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.actionSheetController.create({header:"Que deseas hacer con las facturas seleccionadas : ",cssClass:"my-custom-class",buttons:[{text:"Eliminar",icon:"trash",handler:function(){n.eliminarFacturasSeleccionadas()}},{text:"Canelar",icon:"close",role:"cancel",handler:function(){console.log("Cancel clicked")}}]});case 2:return t=e.sent,e.next=5,t.present();case 5:case"end":return e.stop()}}),e,this)})))}},{key:"mostrarOpcionesIndividual",value:function(e){return Object(u.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.actionSheetController.create({header:"Que deseas hacer con la factura con RFC : "+this.facturas[e].rfc+", Agente: "+this.facturas[e].agente,cssClass:"my-custom-class",buttons:[{text:"Eliminar",icon:"trash",handler:function(){r.eliminarFactura(e)}},{text:"Editar",icon:"create",handler:function(){r.editarFactura(e)}},{text:"Abrir archivo XML",icon:"code-working",handler:function(){r.abrirArchivo(e,"xml")}},{text:"Abrir archivo PDF",icon:"document",handler:function(){r.abrirArchivo(e,"pdf")}},{text:"Canelar",icon:"close",role:"cancel",handler:function(){console.log("Cancel clicked")}}]});case 2:return n=t.sent,t.next=5,n.present();case 5:this.seleccionados=[];case 6:case"end":return t.stop()}}),t,this)})))}},{key:"abrirArchivo",value:function(e,t){var n=document.createElement("a");n.href="".concat(b.a.apiFile,"/file/").concat(this.facturas[e].factura,".").concat(t),n.setAttribute("target","_blank"),n.click(),n.remove()}},{key:"eliminarFacturasSeleccionadas",value:function(){var e,t;return Object(u.b)(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,o,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:console.log("Que pedooo",this.seleccionados),n.prev=1,n.prev=2,o=Object(u.a)(this.seleccionados);case 4:return n.next=6,o.next();case 6:if((r=n.sent).done){n.next=13;break}return a=r.value,console.log("Broooooo"),n.next=11,this.peticionEliminarFactura(a.index);case 11:n.next=4;break;case 13:n.next=18;break;case 15:n.prev=15,n.t0=n.catch(2),e={error:n.t0};case 18:if(n.prev=18,n.prev=19,n.t1=r&&!r.done&&(t=o.return),!n.t1){n.next=24;break}return n.next=24,t.call(o);case 24:if(n.prev=24,!e){n.next=27;break}throw e.error;case 27:return n.finish(24);case 28:return n.finish(18);case 29:this.seleccionados=[],console.log("Segun termino"),this.facturas=this.facturas.filter((function(e){return!e.check})),this.mostrarToast("Se borraron correctamente","success"),n.next=35;break;case 32:n.prev=32,n.t2=n.catch(1),this.mostrarToast("Ocurrio un error al borrarlos","danger");case 35:case"end":return n.stop()}}),n,this,[[1,32],[2,15,18,29],[19,,24,28]])})))}},{key:"peticionEliminarFactura",value:function(e){var t=this;return console.log("Puta peticion"),this.http.delete("".concat(b.a.apiUrl,"/facturas/id?id=").concat(this.facturas[e].id)).toPromise().then((function(e){console.log("resp al eliminar la factura",e)})).catch((function(e){t.mostrarToast("Algo salio mal...","danger"),console.log("Error al al eliminar la factura",e)}))}},{key:"eliminarFactura",value:function(e){var t=this;return this.http.delete("".concat(b.a.apiUrl,"/facturas/id?id=").concat(this.facturas[e].id)).subscribe((function(e){e.success?(t.actionSheetController.dismiss(),t.mostrarToast("Se elimino correctamente","success"),t.facturas=t.facturas.filter((function(e){return!e.check})),console.log("Las",t.facturas)):t.mostrarToast("Algo salio mal...","danger")}),(function(e){t.mostrarToast("Algo salio mal...","danger"),console.log("Error al al eliminar la factura",e)}))}},{key:"buscarFactura",value:function(e){console.log("Valor",e.target.value),this.peticionFactura("prueba"==e.target.value||13==e.target.value.length?"facturas/rfc?rfc="+e.target.value:"facturas/factura?folio="+e.target.value)}},{key:"peticionFactura",value:function(e){var t=this;this.http.get("".concat(b.a.apiUrl,"/").concat(e)).subscribe((function(e){console.log("Resp de buscar factura",e),e.data.length>0?(e.data.forEach((function(e){t.facturas.push(Object.assign(Object.assign({},e),{check:!1}))})),t.facturas=e.data,t.mostrarToast("Se encontraron","success")):t.mostrarToast("No se encotraron","danger")}),(function(e){console.log("Error al buscar la factura",e)}))}},{key:"mostrarToast",value:function(e,t){return Object(u.b)(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.toastCtrl.create({message:e,color:t,duration:3e3});case 2:return r=n.sent,n.next=5,r.present();case 5:case"end":return n.stop()}}),n,this)})))}}]),t}()).\u0275fac=function(e){return new(e||k)(f.Hb(d.a),f.Hb(s.U),f.Hb(s.a),f.Hb(s.Q))},k.\u0275cmp=f.Bb({type:k,selectors:[["app-buscar"]],decls:26,vars:4,consts:[["color","primary",1,"ion-text-center"],["display-format","YYYY-MM-DD",2,"display","none",3,"ionChange"],["fechasInicio",""],["fechasFinal",""],["placeholder","Puedes buscar por RFC o FOLIO","inputmode","text","type","text","debounce","1000",3,"ionChange"],["size","6"],["expand","block","color","dark",3,"click"],["color","danger","expand","block",3,"click"],[4,"ngIf"],[3,"items","trackBy"],[4,"virtualItem"],[3,"ngModel","ngModelChange"]],template:function(e,t){if(1&e){var n=f.Lb();f.Kb(0,"ion-header"),f.Kb(1,"ion-toolbar",0),f.Kb(2,"ion-datetime",1,2),f.Sb("ionChange",(function(e){return t.setFechaInicio(e.target.value)})),f.Jb(),f.Kb(4,"ion-datetime",1,3),f.Sb("ionChange",(function(e){return t.setFechaFinal(e.target.value)})),f.Jb(),f.Kb(6,"ion-title"),f.gc(7,"Buscar factura"),f.Jb(),f.Kb(8,"ion-searchbar",4),f.Sb("ionChange",(function(e){return t.buscarFactura(e)})),f.Jb(),f.Kb(9,"ion-row"),f.Kb(10,"ion-col",5),f.Kb(11,"ion-button",6),f.Sb("click",(function(){return t.seleccionar()})),f.gc(12," Opciones Facturas seleccionadas "),f.Jb(),f.Jb(),f.Kb(13,"ion-col",5),f.Kb(14,"ion-row"),f.Kb(15,"ion-col",5),f.Kb(16,"ion-button",7),f.Sb("click",(function(){return f.cc(n),f.bc(3).open()})),f.gc(17," Fecha de inicio "),f.Jb(),f.fc(18,J,3,3,"p",8),f.Jb(),f.Kb(19,"ion-col",5),f.Kb(20,"ion-button",7),f.Sb("click",(function(){return f.cc(n),f.bc(5).open()})),f.gc(21," Fecha final "),f.Jb(),f.fc(22,K,3,3,"p",8),f.Jb(),f.Jb(),f.Jb(),f.Jb(),f.Jb(),f.Jb(),f.Kb(23,"ion-content"),f.Kb(24,"ion-virtual-scroll",9),f.fc(25,x,22,6,"ion-item",10),f.Jb(),f.Jb()}2&e&&(f.xb(18),f.Zb("ngIf",""!=t.fechaInicio),f.xb(4),f.Zb("ngIf",""!=t.fechaFinal),f.xb(2),f.Zb("items",t.facturas)("trackBy",t.trackByFn))},directives:[s.s,s.L,s.o,s.S,s.K,s.C,s.T,s.B,s.m,s.f,c.j,s.n,s.M,s.V,s.v,s.l,s.c,i.h,i.j,s.w],pipes:[c.d],styles:[""]}),k);function F(e,t){1&e&&(f.Kb(0,"p"),f.gc(1,"El RFC es necesario"),f.Jb())}function w(e,t){if(1&e&&(f.Kb(0,"ion-text",6),f.fc(1,F,2,0,"p",26),f.Kb(2,"p"),f.gc(3," El RFC "),f.Kb(4,"ion-badge",27),f.gc(5,"NO EXISTE"),f.Jb(),f.Jb(),f.Jb()),2&e){var n=f.Ub();f.xb(1),f.Zb("ngIf",(null==n.facturaForm.controls.rfc.errors?null:n.facturaForm.controls.rfc.errors.required)&&n.facturaForm.controls.rfc.dirty)}}function C(e,t){1&e&&(f.Kb(0,"ion-text",28),f.Kb(1,"p"),f.gc(2," El RFC "),f.Kb(3,"ion-badge",29),f.gc(4,"EXISTE"),f.Jb(),f.Jb(),f.Jb())}function I(e,t){if(1&e&&(f.Kb(0,"ion-item",30),f.Kb(1,"ion-label",28),f.gc(2),f.Jb(),f.Jb()),2&e){var n=f.Ub();f.xb(2),f.ic("PDF seleccionado: ",n.pdf.name,"")}}function S(e,t){if(1&e&&(f.Kb(0,"ion-item",30),f.Kb(1,"ion-label",28),f.gc(2),f.Jb(),f.Jb()),2&e){var n=f.Ub();f.xb(2),f.ic("XML seleccionado: ",n.xml.name,"")}}var E,A,R,O,q=((E=function(){function e(t,r,o){n(this,e),this.http=t,this.toastCtrl=r,this.cargando=o}return o(e,[{key:"ngOnInit",value:function(){this.cargarFormulario()}},{key:"subirArchivo",value:function(e,t){var n=t.type.split("/")[1],r=new FormData;return r.append("file",t,e+"."+n),this.http.post(b.a.apiUrl+"/upload",r).toPromise().then((function(e){console.log("Resp para subir archivos",e)})).catch((function(e){return console.log("Error al subir archivos",e)}))}},{key:"seleccionarArchivo",value:function(e){0==(e.target||e.srcElement).value.length?console.log("Cancelo la seleccion"):(console.log("Archivo seleccionado",e.target.files[0]),e.target.files[0].type.endsWith("/pdf")?(this.pdf=e.target.files[0],this.facturaForm.controls.pdf.setValue(!0)):e.target.files[0].type.endsWith("/xml")&&(this.xml=e.target.files[0],this.facturaForm.controls.xml.setValue(!0)))}},{key:"cargarFormulario",value:function(){this.facturaForm=new i.c({agente:new i.a(null,i.m.required),almacen:new i.a(null,i.m.required),awb:new i.a(null,i.m.required),factura:new i.a(null,i.m.required),hbw:new i.a(null,i.m.required),pedimento:new i.a(null,i.m.required),rfc:new i.a(null,[i.m.required,i.m.minLength(4),i.m.maxLength(18)],this.rfcUnico.bind(this)),pdf:new i.a(!1,i.m.requiredTrue),xml:new i.a(!1,i.m.requiredTrue)})}},{key:"crearFactura",value:function(){return Object(u.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.mostrarCargando();case 2:t={agente:this.facturaForm.value.agente,almacen:this.facturaForm.value.almacen,awb:this.facturaForm.value.awb,factura:this.facturaForm.value.factura,hbw:this.facturaForm.value.hbw,pedimento:this.facturaForm.value.pedimento,rfc:this.facturaForm.value.rfc,fecha:(new Date).toISOString()},this.subirArchivo(this.facturaForm.value.factura,this.pdf).then((function(){return n.subirArchivo(n.facturaForm.value.factura,n.xml)})).then((function(){return n.http.post(b.a.apiUrl+"/facturas",t).toPromise()})).then((function(e){console.log("Resp de crear factura",e),e.success?(n.cargando.dismiss(),n.mostrarToast("Se creo correctamente la factura","success"),n.facturaForm.reset({agente:null,almacen:null,awb:null,factura:null,hbw:null,pedimento:null,rfc:null,pdf:!1,xml:!1}),n.pdf=void 0,n.xml=void 0):(n.cargando.dismiss(),n.mostrarToast("Error al crear la factura","danger"))})).catch((function(e){n.cargando.dismiss(),n.mostrarToast("Error al crear la factura","danger"),console.log("Error al subir archivos",e)})),console.log("La factura final sera",t);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"rfcUnico",value:function(e){var t=this;return new Promise((function(e,n){t.http.get("".concat(b.a.apiUrl,"/usuario/rfcValidacion/?rfc=").concat(t.facturaForm.controls.rfc.value)).subscribe((function(t){console.log("Se hizo bien",t),e(1==t.data.length?null:{existe:!0})}),(function(t){console.log("Se hizo MAL",t),e({existe:!0})}))}))}},{key:"mostrarCargando",value:function(){return Object(u.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cargando.create({message:"Subiendo archivos y guardando la factura, espere....",backdropDismiss:!1});case 2:return t=e.sent,e.next=5,t.present();case 5:case"end":return e.stop()}}),e,this)})))}},{key:"mostrarToast",value:function(e,t){return Object(u.b)(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.toastCtrl.create({message:e,color:t,duration:3e3});case 2:return n.abrupt("return",n.sent.present());case 3:case"end":return n.stop()}}),n,this)})))}}]),e}()).\u0275fac=function(e){return new(e||E)(f.Hb(d.a),f.Hb(s.U),f.Hb(s.P))},E.\u0275cmp=f.Bb({type:E,selectors:[["app-crear"]],decls:96,vars:6,consts:[["color","dark",1,"ion-text-center"],[1,"ion-text-center"],[3,"formGroup"],["fixed",""],["size","6"],["position","floating"],["color","danger"],["required","","formControlName","agente","type","text"],["required","","formControlName","almacen","type","text"],["required","","formControlName","awb","type","text"],["required","","formControlName","factura","type","text"],["required","","formControlName","hbw","type","text"],["required","","formControlName","pedimento","type","text"],["size","12"],["debounce","1000","required","","formControlName","rfc","oninput","this.value = this.value.toUpperCase()","type","text"],["color","danger",4,"ngIf"],["color","success",4,"ngIf"],["name","document-outline",2,"font-size","150px"],["color","dark","expand","block","shape","round",3,"click"],["slot","start","name","add"],["style","text-align: center;",4,"ngIf"],["name","code-working",2,"font-size","150px"],["expand","block","color","dark","shape","round",3,"click"],["expand","full",3,"disabled","click"],["type","file","accept",".pdf,.xml",2,"display","none",3,"change"],["archivos",""],[4,"ngIf"],["color","danger","mode","ios"],["color","success"],["color","success","mode","ios"],[2,"text-align","center"]],template:function(e,t){if(1&e){var n=f.Lb();f.Kb(0,"ion-header"),f.Kb(1,"ion-toolbar",0),f.Kb(2,"ion-title"),f.gc(3," Crear Factura"),f.Jb(),f.Jb(),f.Jb(),f.Kb(4,"ion-content"),f.Kb(5,"ion-card"),f.Kb(6,"ion-card-header",1),f.Kb(7,"ion-card-title"),f.gc(8,"Ingresa los datos necesarios"),f.Jb(),f.Jb(),f.Kb(9,"ion-card-content"),f.Kb(10,"form",2),f.Kb(11,"ion-grid",3),f.Kb(12,"ion-row"),f.Kb(13,"ion-col",4),f.Kb(14,"ion-item"),f.Kb(15,"ion-label",5),f.gc(16,"Agente "),f.Kb(17,"ion-text",6),f.gc(18,"*"),f.Jb(),f.Jb(),f.Ib(19,"ion-input",7),f.Jb(),f.Jb(),f.Kb(20,"ion-col",4),f.Kb(21,"ion-item"),f.Kb(22,"ion-label",5),f.gc(23,"Almacen "),f.Kb(24,"ion-text",6),f.gc(25,"*"),f.Jb(),f.Jb(),f.Ib(26,"ion-input",8),f.Jb(),f.Jb(),f.Jb(),f.Kb(27,"ion-row"),f.Kb(28,"ion-col",4),f.Kb(29,"ion-item"),f.Kb(30,"ion-label",5),f.gc(31,"AWB "),f.Kb(32,"ion-text",6),f.gc(33,"*"),f.Jb(),f.Jb(),f.Ib(34,"ion-input",9),f.Jb(),f.Jb(),f.Kb(35,"ion-col",4),f.Kb(36,"ion-item"),f.Kb(37,"ion-label",5),f.gc(38,"Factura "),f.Kb(39,"ion-text",6),f.gc(40,"*"),f.Jb(),f.Jb(),f.Ib(41,"ion-input",10),f.Jb(),f.Jb(),f.Jb(),f.Kb(42,"ion-row"),f.Kb(43,"ion-col",4),f.Kb(44,"ion-item"),f.Kb(45,"ion-label",5),f.gc(46,"HBW "),f.Kb(47,"ion-text",6),f.gc(48,"*"),f.Jb(),f.Jb(),f.Ib(49,"ion-input",11),f.Jb(),f.Jb(),f.Kb(50,"ion-col",4),f.Kb(51,"ion-item"),f.Kb(52,"ion-label",5),f.gc(53,"Pedimento "),f.Kb(54,"ion-text",6),f.gc(55,"*"),f.Jb(),f.Jb(),f.Ib(56,"ion-input",12),f.Jb(),f.Jb(),f.Jb(),f.Kb(57,"ion-row"),f.Kb(58,"ion-col",13),f.Kb(59,"ion-item"),f.Kb(60,"ion-label",5),f.gc(61,"RFC "),f.Kb(62,"ion-text",6),f.gc(63,"*"),f.Jb(),f.Jb(),f.Ib(64,"ion-input",14),f.fc(65,w,6,1,"ion-text",15),f.fc(66,C,5,0,"ion-text",16),f.Jb(),f.Jb(),f.Jb(),f.Jb(),f.Jb(),f.Jb(),f.Jb(),f.Kb(67,"ion-card"),f.Kb(68,"ion-grid",3),f.Kb(69,"ion-row"),f.Kb(70,"ion-col",4),f.Kb(71,"ion-card"),f.Kb(72,"ion-card-header",1),f.Kb(73,"ion-card-title"),f.gc(74,"Archivo PDF necesario"),f.Jb(),f.Jb(),f.Kb(75,"ion-card-content",1),f.Ib(76,"ion-icon",17),f.Jb(),f.Kb(77,"ion-button",18),f.Sb("click",(function(){return f.cc(n),f.bc(95).click()})),f.gc(78," Seleccionar PDF "),f.Ib(79,"ion-icon",19),f.Jb(),f.fc(80,I,3,1,"ion-item",20),f.Jb(),f.Jb(),f.Kb(81,"ion-col",4),f.Kb(82,"ion-card"),f.Kb(83,"ion-card-header",1),f.Kb(84,"ion-card-title"),f.gc(85,"Archivo XML necesario"),f.Jb(),f.Jb(),f.Kb(86,"ion-card-content",1),f.Ib(87,"ion-icon",21),f.Jb(),f.Kb(88,"ion-button",22),f.Sb("click",(function(){return f.cc(n),f.bc(95).click()})),f.gc(89," Seleccionar XML "),f.Ib(90,"ion-icon",19),f.Jb(),f.fc(91,S,3,1,"ion-item",20),f.Jb(),f.Jb(),f.Jb(),f.Jb(),f.Kb(92,"ion-button",23),f.Sb("click",(function(){return t.crearFactura()})),f.gc(93," Crear factura "),f.Jb(),f.Jb(),f.Kb(94,"input",24,25),f.Sb("change",(function(e){return t.seleccionarArchivo(e)})),f.Jb(),f.Jb()}2&e&&(f.xb(10),f.Zb("formGroup",t.facturaForm),f.xb(55),f.Zb("ngIf",null==t.facturaForm.controls.rfc.errors?null:t.facturaForm.controls.rfc.errors.existe),f.xb(1),f.Zb("ngIf",t.facturaForm.controls.rfc.valid),f.xb(14),f.Zb("ngIf",null!=t.pdf),f.xb(11),f.Zb("ngIf",null!=t.xml),f.xb(1),f.Zb("disabled",t.facturaForm.invalid))},directives:[s.s,s.L,s.K,s.n,s.h,s.j,s.k,s.i,i.n,i.i,i.d,s.r,s.B,s.m,s.v,s.w,s.J,s.u,s.T,i.l,i.h,i.b,c.j,s.t,s.f,s.e],styles:[""]}),E),P=[{path:"",component:(A=function(){function e(){n(this,e)}return o(e,[{key:"ngOnInit",value:function(){}}]),e}(),A.\u0275fac=function(e){return new(e||A)},A.\u0275cmp=f.Bb({type:A,selectors:[["app-facturas-tabs"]],decls:10,vars:0,consts:[["color","dark","slot","bottom,top"],["tab","crear"],["name","add-circle"],["tab","buscar"],["name","search"]],template:function(e,t){1&e&&(f.Kb(0,"ion-tabs"),f.Kb(1,"ion-tab-bar",0),f.Kb(2,"ion-tab-button",1),f.Ib(3,"ion-icon",2),f.Kb(4,"ion-label"),f.gc(5,"Crear"),f.Jb(),f.Jb(),f.Kb(6,"ion-tab-button",3),f.Ib(7,"ion-icon",4),f.Kb(8,"ion-label"),f.gc(9,"Buscar"),f.Jb(),f.Jb(),f.Jb(),f.Jb())},directives:[s.I,s.G,s.H,s.t,s.w],styles:[""]}),A),children:[{path:"",redirectTo:"crear",pathMatch:"full"},{path:"crear",component:q},{path:"buscar",component:y}]}],T=((O=function e(){n(this,e)}).\u0275mod=f.Fb({type:O}),O.\u0275inj=f.Eb({factory:function(e){return new(e||O)},imports:[[l.h.forChild(P)],l.h]}),O),j=((R=function e(){n(this,e)}).\u0275mod=f.Fb({type:R}),R.\u0275inj=f.Eb({factory:function(e){return new(e||R)},imports:[[c.b,s.N,T,i.e,i.k,d.b]]}),R)}}])}();