(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{xnqB:function(e,c,t){"use strict";t.r(c),t.d(c,"FacturasPageModule",(function(){return m}));var n=t("ofXK"),o=t("3Pt+"),i=t("TEn/"),a=t("tyNb"),s=t("mrSG"),r=t("AytR"),l=t("fXoL"),b=t("tk/3"),h=t("lGQG");function u(e,c){if(1&e&&(l.Kb(0,"p"),l.gc(1),l.Vb(2,"date"),l.Jb()),2&e){const e=l.Ub();l.xb(1),l.hc(l.Wb(2,1,e.fechaInicio))}}function d(e,c){if(1&e&&(l.Kb(0,"p"),l.gc(1),l.Vb(2,"date"),l.Jb()),2&e){const e=l.Ub();l.xb(1),l.hc(l.Wb(2,1,e.fechaFinal))}}function f(e,c){if(1&e){const e=l.Lb();l.Kb(0,"ion-item"),l.Kb(1,"ion-checkbox",11),l.Sb("ngModelChange",(function(t){return l.cc(e),c.$implicit.check=t})),l.Jb(),l.Kb(2,"ion-label"),l.gc(3," RFC "),l.Kb(4,"p"),l.gc(5),l.Jb(),l.Jb(),l.Kb(6,"ion-label"),l.gc(7," Agente "),l.Kb(8,"p"),l.gc(9),l.Jb(),l.Jb(),l.Kb(10,"ion-label"),l.gc(11," Factura "),l.Kb(12,"p"),l.gc(13),l.Jb(),l.Jb(),l.Kb(14,"ion-label"),l.gc(15," pedimento "),l.Kb(16,"p"),l.gc(17),l.Jb(),l.Jb(),l.Kb(18,"ion-label"),l.gc(19," Fecha "),l.Kb(20,"p"),l.gc(21),l.Jb(),l.Jb(),l.Jb()}if(2&e){const e=c.$implicit;l.xb(1),l.Zb("ngModel",e.check),l.xb(4),l.ic(" ",e.rfc," "),l.xb(4),l.ic(" ",e.agente," "),l.xb(4),l.ic(" ",e.factura," "),l.xb(4),l.ic(" ",e.pedimento," "),l.xb(4),l.ic(" ",e.fecha," ")}}const p=[{path:"",component:(()=>{class e{constructor(e,c,t,n){this.http=e,this.toastCtrl=c,this.auth=t,this.actionSheetController=n,this.facturas=void 0,this.seleccionados=[],this.fechaInicio="",this.fechaFinal=""}ngOnInit(){this.peticionFactura("facturas/agente?agente="+this.auth.usuario.rfc)}setFechaInicio(e){console.log("la fecha inicio es",e),this.fechaInicio=e}setFechaFinal(e){console.log("la fecha final es",e),this.fechaFinal=e}seleccionar(){this.facturas.forEach((e,c)=>{e.check&&this.seleccionados.push({index:c,factura:e.factura})}),1==this.seleccionados.length?this.mostrarOpcionesIndividual(this.seleccionados[0].index):this.mostrarOpcionesMultiple(),console.log("Seleccionados",this.seleccionados)}mostrarOpcionesMultiple(){return Object(s.b)(this,void 0,void 0,(function*(){const e=yield this.actionSheetController.create({header:"Que deseas hacer con las facturas seleccionadas : ",cssClass:"my-custom-class",buttons:[{text:"Descargar xml y pdf seleccionados",icon:"cloud-download",handler:()=>{}},{text:"Canelar",icon:"close",role:"cancel",handler:()=>{console.log("Cancel clicked")}}]});yield e.present()}))}mostrarOpcionesIndividual(e){return Object(s.b)(this,void 0,void 0,(function*(){const c=yield this.actionSheetController.create({header:"Que deseas hacer con el pago con RFC : "+this.facturas[e].rfc+", Agente: "+this.facturas[e].agente,cssClass:"my-custom-class",buttons:[{text:"Abrir archivo XML",icon:"code-working",handler:()=>{this.abrirArchivo(e,"xml")}},{text:"Abrir archivo PDF",icon:"document",handler:()=>{this.abrirArchivo(e,"pdf")}},{text:"Canelar",icon:"close",role:"cancel",handler:()=>{console.log("Cancel clicked")}}]});yield c.present()}))}abrirArchivo(e,c){const t=document.createElement("a");t.href=`${r.a.apiFile}/file/${this.facturas[e].factura}.${c}`,t.setAttribute("target","_blank"),t.click(),t.remove()}peticionFactura(e){this.http.get(`${r.a.apiUrl}/${e}`).subscribe(e=>{console.log("Resp de buscar factura",e),e.data.length>0?(e.data.forEach(e=>{this.facturas.push(Object.assign(Object.assign({},e),{check:!1}))}),this.mostrarToast("Se encontraron","success")):this.mostrarToast("No se encotraron","danger")},e=>{console.log("Error al buscar la factura",e)})}mostrarToast(e,c){return Object(s.b)(this,void 0,void 0,(function*(){const t=yield this.toastCtrl.create({message:e,color:c,duration:3e3});yield t.present()}))}}return e.\u0275fac=function(c){return new(c||e)(l.Hb(b.a),l.Hb(i.S),l.Hb(h.a),l.Hb(i.a))},e.\u0275cmp=l.Bb({type:e,selectors:[["app-facturas"]],decls:26,vars:3,consts:[["color","primary",1,"ion-text-center"],["display-format","YYYY-MM-DD",2,"display","none",3,"ionChange"],["fechasInicio",""],["fechasFinal",""],["size","6"],["expand","block","color","dark",3,"click"],["name","checkbox-outline"],["color","danger","expand","block",3,"click"],[4,"ngIf"],[3,"items"],[4,"virtualItem"],[3,"ngModel","ngModelChange"]],template:function(e,c){if(1&e){const e=l.Lb();l.Kb(0,"ion-header"),l.Kb(1,"ion-toolbar",0),l.Kb(2,"ion-title"),l.gc(3,"Mis facturas"),l.Jb(),l.Kb(4,"ion-datetime",1,2),l.Sb("ionChange",(function(e){return c.setFechaInicio(e.target.value)})),l.Jb(),l.Kb(6,"ion-datetime",1,3),l.Sb("ionChange",(function(e){return c.setFechaFinal(e.target.value)})),l.Jb(),l.Kb(8,"ion-row"),l.Kb(9,"ion-col",4),l.Kb(10,"ion-button",5),l.Sb("click",(function(){return c.seleccionar()})),l.Ib(11,"ion-icon",6),l.gc(12," Opciones Factura 's' seleccionada 's' "),l.Jb(),l.Jb(),l.Kb(13,"ion-col",4),l.Kb(14,"ion-row"),l.Kb(15,"ion-col",4),l.Kb(16,"ion-button",7),l.Sb("click",(function(){return l.cc(e),l.bc(5).open()})),l.gc(17," Fecha de inicio "),l.Jb(),l.fc(18,u,3,3,"p",8),l.Jb(),l.Kb(19,"ion-col",4),l.Kb(20,"ion-button",7),l.Sb("click",(function(){return l.cc(e),l.bc(7).open()})),l.gc(21," Fecha final "),l.Jb(),l.fc(22,d,3,3,"p",8),l.Jb(),l.Jb(),l.Jb(),l.Jb(),l.Jb(),l.Jb(),l.Kb(23,"ion-content"),l.Kb(24,"ion-virtual-scroll",9),l.fc(25,f,22,6,"ion-item",10),l.Jb(),l.Jb()}2&e&&(l.xb(18),l.Zb("ngIf",""!=c.fechaInicio),l.xb(4),l.Zb("ngIf",""!=c.fechaFinal),l.xb(2),l.Zb("items",c.facturas))},directives:[i.q,i.J,i.I,i.o,i.Q,i.z,i.m,i.f,i.r,n.j,i.n,i.K,i.T,i.t,i.l,i.c,o.h,o.j,i.u],pipes:[n.d],styles:[""]}),e})()}];let g=(()=>{class e{}return e.\u0275mod=l.Fb({type:e}),e.\u0275inj=l.Eb({factory:function(c){return new(c||e)},imports:[[a.h.forChild(p)],a.h]}),e})(),m=(()=>{class e{}return e.\u0275mod=l.Fb({type:e}),e.\u0275inj=l.Eb({factory:function(c){return new(c||e)},imports:[[n.b,o.e,i.L,g]]}),e})()}}]);